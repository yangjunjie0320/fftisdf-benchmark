OMP_NUM_THREADS = 32
MKL_NUM_THREADS = 1
PYSCF_MAX_MEMORY = 245760
TMPDIR = /central/scratch/yangjunjie//fftdf-supercell/46923318/
PYSCF_TMPDIR = /central/scratch/yangjunjie//fftdf-supercell/46923318/

/home/junjiey/anaconda3/envs/fftisdf/bin/python
2.7.0
1.14.1
1.26.4
#INFO: **** input file is /central/home/junjiey/work/fftisdf-benchmark/work/diamond-conv-2-2-2/gth-szv-molopt-sr-20/fftdf-supercell/main.py ****
import os, sys
import numpy, scipy
import pyscf

TMPDIR = os.getenv("TMPDIR", None)
DATA_PATH = os.getenv("DATA_PATH", None)
PYSCF_MAX_MEMORY = os.getenv("PYSCF_MAX_MEMORY", 4000)
PYSCF_MAX_MEMORY = int(PYSCF_MAX_MEMORY)

def main(args):
    from utils import cell_from_poscar
    path = os.path.join(DATA_PATH, args.cell)
    assert os.path.exists(path), "Cell file not found: %s" % path

    c = cell_from_poscar(path)
    c.basis = args.basis
    c.pseudo = args.pseudo
    c.verbose = 0
    c.unit = 'aa'
    # c.exp_to_discard = 0.1
    # c.exp_to_discard = 0.0
    c.max_memory = PYSCF_MAX_MEMORY
    c.ke_cutoff = args.ke_cutoff
    c.build(dump_input=False)

    kmesh = [int(x) for x in args.kmesh.split("-")]
    kmesh = numpy.array(kmesh)
    kpts = c.get_kpts(kmesh)

    pcell = c.copy(deep=True)

    natm = len(pcell.atom)
    atm = []
    for ia in range(natm):
        s = pcell.atom_symbol(ia)
        x = pcell.atom_coord(ia, unit='A')
        atm.append([s, x])

    from pyscf.lib.parameters import BOHR
    lvx = pcell.lattice_vectors() * BOHR

    from pyscf.isdf.isdf_tools_cell import build_supercell_with_partition
    scell, group = build_supercell_with_partition(
        atm, lvx, spin=0, charge=0, mesh=None, Ls=kmesh,
        partition=None, basis=args.basis,
        pseudo=args.pseudo, ke_cutoff=args.ke_cutoff,
        max_memory=PYSCF_MAX_MEMORY, 
        precision=1e-12, 
        use_particle_mesh_ewald=True,
        verbose=4,
    )

    from pyscf.pbc.df.fft import FFTDF
    df_obj = FFTDF(scell)
    df_obj.verbose = 10

    from utils import get_jk_time
    kmesh = None
    tmp = os.path.join(TMPDIR, "fftdf.chk")
    os.system("touch %s" % tmp)
    
    get_jk_time(scell, kmesh=kmesh, df_obj=df_obj, tmp=tmp)

if __name__ == "__main__":
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument("--cell", type=str, default="diamond-prim.vasp")
    parser.add_argument("--kmesh", type=str, default="2-2-2")
    parser.add_argument("--ke_cutoff", type=float, default=200)
    parser.add_argument("--basis", type=str, default="gth-dzvp-molopt-sr")
    parser.add_argument("--pseudo", type=str, default="gth-pade")

    args = parser.parse_args()
    main(args)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-80-27.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 32
Python 3.12.3 | packaged by conda-forge | (main, Apr 15 2024, 18:38:13) [GCC 12.3.0]
numpy 1.26.4  scipy 1.14.1  h5py 3.12.1
Date: Wed Jan 22 22:03:29 2025
PySCF version 2.7.0
PySCF path  /home/junjiey/anaconda3/envs/fftisdf/lib/python3.12/site-packages/pyscf

[ENV] PYSCF_TMPDIR /central/scratch/yangjunjie//fftdf-supercell/46923318/
[ENV] PYSCF_MAX_MEMORY 245760
[ENV] PYSCF_EXT_PATH /home/junjiey/packages/pyscf-forge/pyscf-forge-yangjunjie-non-orth/
[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 64
[INPUT] num. electrons = 256
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   1.780372554545 AA    0.000000000000   0.000000000000   3.364416527783 Bohr   0.0
[INPUT]  2 C      0.890186277273   0.890186277273   2.670558831818 AA    1.682208263891   1.682208263891   5.046624791674 Bohr   0.0
[INPUT]  3 C     -0.000000000000   1.780372554545   0.000000000000 AA   -0.000000000000   3.364416527783   0.000000000000 Bohr   0.0
[INPUT]  4 C      0.890186277273   2.670558831818   0.890186277273 AA    1.682208263891   5.046624791674   1.682208263891 Bohr   0.0
[INPUT]  5 C      1.780372554545   0.000000000000   0.000000000000 AA    3.364416527783   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  6 C      2.670558831818   0.890186277273   0.890186277273 AA    5.046624791674   1.682208263891   1.682208263891 Bohr   0.0
[INPUT]  7 C      1.780372554545   1.780372554545   1.780372554545 AA    3.364416527783   3.364416527783   3.364416527783 Bohr   0.0
[INPUT]  8 C      2.670558831818   2.670558831818   2.670558831818 AA    5.046624791674   5.046624791674   5.046624791674 Bohr   0.0
[INPUT]  9 C      0.000000000000   0.000000000000   5.341117663635 AA    0.000000000000   0.000000000000  10.093249583348 Bohr   0.0
[INPUT] 10 C      0.890186277273   0.890186277273   6.231303940908 AA    1.682208263891   1.682208263891  11.775457847239 Bohr   0.0
[INPUT] 11 C     -0.000000000000   1.780372554545   3.560745109090 AA   -0.000000000000   3.364416527783   6.728833055565 Bohr   0.0
[INPUT] 12 C      0.890186277273   2.670558831818   4.450931386363 AA    1.682208263891   5.046624791674   8.411041319457 Bohr   0.0
[INPUT] 13 C      1.780372554545   0.000000000000   3.560745109090 AA    3.364416527783   0.000000000000   6.728833055565 Bohr   0.0
[INPUT] 14 C      2.670558831818   0.890186277273   4.450931386363 AA    5.046624791674   1.682208263891   8.411041319457 Bohr   0.0
[INPUT] 15 C      1.780372554545   1.780372554545   5.341117663635 AA    3.364416527783   3.364416527783  10.093249583348 Bohr   0.0
[INPUT] 16 C      2.670558831818   2.670558831818   6.231303940908 AA    5.046624791674   5.046624791674  11.775457847239 Bohr   0.0
[INPUT] 17 C     -0.000000000000   3.560745109090   1.780372554545 AA   -0.000000000000   6.728833055565   3.364416527783 Bohr   0.0
[INPUT] 18 C      0.890186277273   4.450931386363   2.670558831818 AA    1.682208263891   8.411041319457   5.046624791674 Bohr   0.0
[INPUT] 19 C     -0.000000000000   5.341117663635   0.000000000000 AA   -0.000000000000  10.093249583348   0.000000000000 Bohr   0.0
[INPUT] 20 C      0.890186277273   6.231303940908   0.890186277273 AA    1.682208263891  11.775457847239   1.682208263891 Bohr   0.0
[INPUT] 21 C      1.780372554545   3.560745109090   0.000000000000 AA    3.364416527783   6.728833055565   0.000000000000 Bohr   0.0
[INPUT] 22 C      2.670558831818   4.450931386363   0.890186277273 AA    5.046624791674   8.411041319457   1.682208263891 Bohr   0.0
[INPUT] 23 C      1.780372554545   5.341117663635   1.780372554545 AA    3.364416527783  10.093249583348   3.364416527783 Bohr   0.0
[INPUT] 24 C      2.670558831818   6.231303940908   2.670558831818 AA    5.046624791674  11.775457847239   5.046624791674 Bohr   0.0
[INPUT] 25 C     -0.000000000000   3.560745109090   5.341117663635 AA   -0.000000000000   6.728833055565  10.093249583348 Bohr   0.0
[INPUT] 26 C      0.890186277273   4.450931386363   6.231303940908 AA    1.682208263891   8.411041319457  11.775457847239 Bohr   0.0
[INPUT] 27 C     -0.000000000000   5.341117663635   3.560745109090 AA   -0.000000000000  10.093249583348   6.728833055565 Bohr   0.0
[INPUT] 28 C      0.890186277273   6.231303940908   4.450931386363 AA    1.682208263891  11.775457847239   8.411041319457 Bohr   0.0
[INPUT] 29 C      1.780372554545   3.560745109090   3.560745109090 AA    3.364416527783   6.728833055565   6.728833055565 Bohr   0.0
[INPUT] 30 C      2.670558831818   4.450931386363   4.450931386363 AA    5.046624791674   8.411041319457   8.411041319457 Bohr   0.0
[INPUT] 31 C      1.780372554545   5.341117663635   5.341117663635 AA    3.364416527783  10.093249583348  10.093249583348 Bohr   0.0
[INPUT] 32 C      2.670558831818   6.231303940908   6.231303940908 AA    5.046624791674  11.775457847239  11.775457847239 Bohr   0.0
[INPUT] 33 C      3.560745109090   0.000000000000   1.780372554545 AA    6.728833055565   0.000000000000   3.364416527783 Bohr   0.0
[INPUT] 34 C      4.450931386363   0.890186277273   2.670558831818 AA    8.411041319457   1.682208263891   5.046624791674 Bohr   0.0
[INPUT] 35 C      3.560745109090   1.780372554545   0.000000000000 AA    6.728833055565   3.364416527783   0.000000000000 Bohr   0.0
[INPUT] 36 C      4.450931386363   2.670558831818   0.890186277273 AA    8.411041319457   5.046624791674   1.682208263891 Bohr   0.0
[INPUT] 37 C      5.341117663635   0.000000000000   0.000000000000 AA   10.093249583348   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] 38 C      6.231303940908   0.890186277273   0.890186277273 AA   11.775457847239   1.682208263891   1.682208263891 Bohr   0.0
[INPUT] 39 C      5.341117663635   1.780372554545   1.780372554545 AA   10.093249583348   3.364416527783   3.364416527783 Bohr   0.0
[INPUT] 40 C      6.231303940908   2.670558831818   2.670558831818 AA   11.775457847239   5.046624791674   5.046624791674 Bohr   0.0
[INPUT] 41 C      3.560745109090   0.000000000000   5.341117663635 AA    6.728833055565   0.000000000000  10.093249583348 Bohr   0.0
[INPUT] 42 C      4.450931386363   0.890186277273   6.231303940908 AA    8.411041319457   1.682208263891  11.775457847239 Bohr   0.0
[INPUT] 43 C      3.560745109090   1.780372554545   3.560745109090 AA    6.728833055565   3.364416527783   6.728833055565 Bohr   0.0
[INPUT] 44 C      4.450931386363   2.670558831818   4.450931386363 AA    8.411041319457   5.046624791674   8.411041319457 Bohr   0.0
[INPUT] 45 C      5.341117663635   0.000000000000   3.560745109090 AA   10.093249583348   0.000000000000   6.728833055565 Bohr   0.0
[INPUT] 46 C      6.231303940908   0.890186277273   4.450931386363 AA   11.775457847239   1.682208263891   8.411041319457 Bohr   0.0
[INPUT] 47 C      5.341117663635   1.780372554545   5.341117663635 AA   10.093249583348   3.364416527783  10.093249583348 Bohr   0.0
[INPUT] 48 C      6.231303940908   2.670558831818   6.231303940908 AA   11.775457847239   5.046624791674  11.775457847239 Bohr   0.0
[INPUT] 49 C      3.560745109090   3.560745109090   1.780372554545 AA    6.728833055565   6.728833055565   3.364416527783 Bohr   0.0
[INPUT] 50 C      4.450931386363   4.450931386363   2.670558831818 AA    8.411041319457   8.411041319457   5.046624791674 Bohr   0.0
[INPUT] 51 C      3.560745109090   5.341117663635   0.000000000000 AA    6.728833055565  10.093249583348   0.000000000000 Bohr   0.0
[INPUT] 52 C      4.450931386363   6.231303940908   0.890186277273 AA    8.411041319457  11.775457847239   1.682208263891 Bohr   0.0
[INPUT] 53 C      5.341117663635   3.560745109090   0.000000000000 AA   10.093249583348   6.728833055565   0.000000000000 Bohr   0.0
[INPUT] 54 C      6.231303940908   4.450931386363   0.890186277273 AA   11.775457847239   8.411041319457   1.682208263891 Bohr   0.0
[INPUT] 55 C      5.341117663635   5.341117663635   1.780372554545 AA   10.093249583348  10.093249583348   3.364416527783 Bohr   0.0
[INPUT] 56 C      6.231303940908   6.231303940908   2.670558831818 AA   11.775457847239  11.775457847239   5.046624791674 Bohr   0.0
[INPUT] 57 C      3.560745109090   3.560745109090   5.341117663635 AA    6.728833055565   6.728833055565  10.093249583348 Bohr   0.0
[INPUT] 58 C      4.450931386363   4.450931386363   6.231303940908 AA    8.411041319457   8.411041319457  11.775457847239 Bohr   0.0
[INPUT] 59 C      3.560745109090   5.341117663635   3.560745109090 AA    6.728833055565  10.093249583348   6.728833055565 Bohr   0.0
[INPUT] 60 C      4.450931386363   6.231303940908   4.450931386363 AA    8.411041319457  11.775457847239   8.411041319457 Bohr   0.0
[INPUT] 61 C      5.341117663635   3.560745109090   3.560745109090 AA   10.093249583348   6.728833055565   6.728833055565 Bohr   0.0
[INPUT] 62 C      6.231303940908   4.450931386363   4.450931386363 AA   11.775457847239   8.411041319457   8.411041319457 Bohr   0.0
[INPUT] 63 C      5.341117663635   5.341117663635   5.341117663635 AA   10.093249583348  10.093249583348  10.093249583348 Bohr   0.0
[INPUT] 64 C      6.231303940908   6.231303940908   6.231303940908 AA   11.775457847239  11.775457847239  11.775457847239 Bohr   0.0

nuclear repulsion = -409.883939136009
number of shells = 128
number of NR pGTOs = 1280
number of NR cGTOs = 256
basis = gth-szv-molopt-sr
ecp = {}
CPU time:         4.65
lattice vectors  a1 [13.457666111, 0.000000000, 0.000000000]
                 a2 [-0.000000000, 13.457666111, 0.000000000]
                 a3 [0.000000000, 0.000000000, 13.457666111]
dimension = 3
low_dim_ft_type = None
Cell volume = 2437.3
rcut = 23.683348913310077 (nimgs = [2 2 2])
lattice sum = 279 cells
precision = 1e-12
pseudo = gth-pade
ke_cutoff = 20.0
    = [29 29 29] mesh (24389 PWs)
Initial guess from minao.

WARN: ke_cutoff/mesh (20 / [29 29 29]) is not enough for FFTDF to get integral accuracy 1e-12.
Coulomb integral error is ~ 15 Eh.
Recommended ke_cutoff/mesh are 740.376 / [167 167 167].

