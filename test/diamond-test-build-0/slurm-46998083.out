OMP_NUM_THREADS = 64
MKL_NUM_THREADS = 1
PYSCF_MAX_MEMORY = 491520
TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/
PYSCF_TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/

/home/junjiey/anaconda3/envs/fftisdf/bin/python
2.7.0
1.14.1
1.26.4
LOADING ISDF BACKEND
NUM_THREADS   : 64
USE_NUMPY     : 0
USE_SCIPY     : 0
USE_TORCH     : 1
USE_TORCH_GPU : 0
arg.atm = [[ 4 20  1 23  0  0]
 [ 4 24  1 27  0  0]
 [ 4 28  1 31  0  0]
 [ 4 32  1 35  0  0]
 [ 4 36  1 39  0  0]
 [ 4 40  1 43  0  0]
 [ 4 44  1 47  0  0]
 [ 4 48  1 51  0  0]]
arg.bas = [[ 0  0  5  2  0 52 57  0]
 [ 0  1  5  2  0 67 72  0]
 [ 0  2  5  1  0 82 87  0]
 [ 1  0  5  2  0 52 57  0]
 [ 1  1  5  2  0 67 72  0]
 [ 1  2  5  1  0 82 87  0]
 [ 2  0  5  2  0 52 57  0]
 [ 2  1  5  2  0 67 72  0]
 [ 2  2  5  1  0 82 87  0]
 [ 3  0  5  2  0 52 57  0]
 [ 3  1  5  2  0 67 72  0]
 [ 3  2  5  1  0 82 87  0]
 [ 4  0  5  2  0 52 57  0]
 [ 4  1  5  2  0 67 72  0]
 [ 4  2  5  1  0 82 87  0]
 [ 5  0  5  2  0 52 57  0]
 [ 5  1  5  2  0 67 72  0]
 [ 5  2  5  1  0 82 87  0]
 [ 6  0  5  2  0 52 57  0]
 [ 6  1  5  2  0 67 72  0]
 [ 6  2  5  1  0 82 87  0]
 [ 7  0  5  2  0 52 57  0]
 [ 7  1  5  2  0 67 72  0]
 [ 7  2  5  1  0 82 87  0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.14328643  0.75521952 -0.74331592
 -0.77915081 -0.08078366  1.95761895  0.29093741  0.02780209  0.48527241
  0.26332695  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225
 -1.44059548 -1.3150188  -0.76719096 -0.28600475 -0.05699711 -0.98316391
 -1.13158177 -0.64703904  0.43083118  0.15573998  5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.01465273  0.43485666  0.70818476
  0.04545847  0.04722778]
ecpbas  = []
#INFO: **** input file is /central/home/junjiey/work/fftisdf-benchmark/test/diamond-test-build-0/main.py ****
# backend to test #

import pyscf.isdf.BackEnd._config as config

config.disable_fftw()
# config.backend("numpy")
# config.backend("scipy")
config.backend("torch")
# config.backend("torch_gpu")
import pyscf.isdf.BackEnd.isdf_backend as BACKEND

# sys and pyscf #

import numpy as np
from pyscf import lib

from pyscf.lib.parameters import BOHR
from pyscf.pbc import df

# isdf util #

from pyscf.isdf.isdf_tools_Tsym import _kmesh_to_Kpoints, _1e_operator_gamma2k
from pyscf.isdf import isdf_tools_cell
from pyscf.isdf.isdf import ISDF
from pyscf.isdf.isdf_local import ISDF_Local

#############################

ke_cutoff = 70
basis = "gth-dzvp-molopt-sr"

boxlen = 3.57371000
prim_a = np.array([[boxlen, 0.0, 0.0], [0.0, boxlen, 0.0], [0.0, 0.0, boxlen]])
atm = [
    ["C", (0.0, 0.0, 0.0)],
    ["C", (0.8934275, 0.8934275, 0.8934275)],
    ["C", (1.786855, 1.786855, 0.0)],
    ["C", (2.6802825, 2.6802825, 0.8934275)],
    ["C", (1.786855, 0.0, 1.786855)],
    ["C", (2.6802825, 0.8934275, 2.6802825)],
    ["C", (0.0, 1.786855, 1.786855)],
    ["C", (0.8934275, 2.6802825, 2.6802825)],
]

kmeshes = [
    [1, 1, 1],
    [1, 1, 2],
    [1, 2, 2],
    [2, 2, 2],
    [2, 2, 4],
    [2, 4, 4],
    [4, 4, 4],
]  # -44.20339674 and -88.67568935
VERBOSE = 10

prim_cell = isdf_tools_cell.build_supercell(
    atm,
    prim_a,
    Ls=[1, 1, 1],
    ke_cutoff=ke_cutoff,
    basis=basis,
    pseudo="gth-pade",
    verbose=VERBOSE,
)

prim_group = [[0, 1], [2, 3], [4, 5], [6, 7]]

prim_mesh = prim_cell.mesh

for kmesh in kmeshes:

    mesh = [int(k * x) for k, x in zip(kmesh, prim_mesh)]
    print("kmesh:", kmesh, "mesh:", mesh)

    kpts = prim_cell.make_kpts(kmesh)

    cell, group = isdf_tools_cell.build_supercell_with_partition(
        atm,
        prim_a,
        Ls=kmesh,
        ke_cutoff=ke_cutoff,
        partition=prim_group,
        mesh=mesh,
        basis=basis,
        pseudo="gth-pade",
        verbose=VERBOSE,
    )
    
    from pyscf import __config__
    MAX_MEMORY = getattr(__config__, 'MAX_MEMORY')
    cell.max_memory = MAX_MEMORY
    print("cell:", cell.max_memory)
    print("group:", group)

    build_V_K_bunchsize = 512
    isdf = ISDF_Local(
        cell, with_robust_fitting=True, 
        limited_memory=True, 
        build_V_K_bunchsize=build_V_K_bunchsize
    )
    isdf.build(c=30, m=5, rela_cutoff=1e-4, group=group)

    from pyscf.pbc import scf

    mf = scf.RHF(cell)
    mf.with_df = isdf
    mf.max_cycle = 1
    mf.kernel()
    #INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-35-02.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 1
Python 3.12.3 | packaged by conda-forge | (main, Apr 15 2024, 18:38:13) [GCC 12.3.0]
numpy 1.26.4  scipy 1.14.1  h5py 3.12.1
Date: Mon Jan 27 15:29:20 2025
PySCF version 2.7.0
PySCF path  /home/junjiey/anaconda3/envs/fftisdf/lib/python3.12/site-packages/pyscf

[ENV] PYSCF_TMPDIR /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[ENV] PYSCF_MAX_MEMORY 491520
[ENV] PYSCF_EXT_PATH /home/junjiey/packages/pyscf-forge/pyscf-forge-yangjunjie-non-orth/
[CONFIG] ARGPARSE = False
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 491520
[CONFIG] TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = None
[INPUT] verbose = 10
[INPUT] max_memory = 2000 
[INPUT] num. atoms = 8
[INPUT] num. electrons = 32
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 C      0.893427500000   0.893427500000   0.893427500000 AA    1.688333287155   1.688333287155   1.688333287155 Bohr   0.0
[INPUT]  3 C      1.786855000000   1.786855000000   0.000000000000 AA    3.376666574310   3.376666574310   0.000000000000 Bohr   0.0
[INPUT]  4 C      2.680282500000   2.680282500000   0.893427500000 AA    5.064999861465   5.064999861465   1.688333287155 Bohr   0.0
[INPUT]  5 C      1.786855000000   0.000000000000   1.786855000000 AA    3.376666574310   0.000000000000   3.376666574310 Bohr   0.0
[INPUT]  6 C      2.680282500000   0.893427500000   2.680282500000 AA    5.064999861465   1.688333287155   5.064999861465 Bohr   0.0
[INPUT]  7 C      0.000000000000   1.786855000000   1.786855000000 AA    0.000000000000   3.376666574310   3.376666574310 Bohr   0.0
[INPUT]  8 C      0.893427500000   2.680282500000   2.680282500000 AA    1.688333287155   5.064999861465   5.064999861465 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] C
[INPUT] 0    0    [5    /2   ]  5.6053307517      0.1115328819 0.4665074832
                                2.11301639053     0.1531421941 0.1441132128
                                0.76991145481     -0.3213968794 0.0293648809
                                0.348157086385    -0.6109264216 0.9294703884
                                0.12821225471     -0.1339908628 1.0669143312
[INPUT] 1    0    [5    /2   ]  5.6053307517      -0.0648689785 -0.0554756934
                                2.11301639053     -0.2004702557 -0.2161651752
                                0.76991145481     -0.4131417301 -0.4366242723
                                0.348157086385    -0.4153371392 0.7840006984
                                0.12821225471     -0.2885276736 0.987908135
[INPUT] 2    0    [5    /1   ]  5.6053307517      0.0299527746
                                2.11301639053     0.0707844588
                                0.76991145481     0.6746010586
                                0.348157086385    0.1736520618
                                0.12821225471     1.0363170247

Ewald components = 11.6062017390159, -63.0574091279915, 0.401589778745918
nuclear repulsion = -51.0496176102297
number of shells = 24
number of NR pGTOs = 360
number of NR cGTOs = 104
basis = gth-dzvp-molopt-sr
ecp = {}
bas 0, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 1, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 2, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 3, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 4, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 5, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 6, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 7, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 8, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 9, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 10, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 11, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 12, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 13, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 14, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 15, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 16, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 17, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 18, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 19, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 20, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 21, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 22, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 23, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
CPU time:         9.45
lattice vectors  a1 [6.753333149, 0.000000000, 0.000000000]
                 a2 [0.000000000, 6.753333149, 0.000000000]
                 a3 [0.000000000, 0.000000000, 6.753333149]
dimension = 3
low_dim_ft_type = None
Cell volume = 308.003
rcut = 22.25045319935835 (nimgs = [4 4 4])
lattice sum = 899 cells
precision = 1e-08
pseudo = gth-pade
ke_cutoff = 70
    = [27 27 27] mesh (19683 PWs)
kmesh: [1, 1, 1] mesh: [27, 27, 27]
arg.atm = [[ 4 20  1 23  0  0]
 [ 4 24  1 27  0  0]
 [ 4 28  1 31  0  0]
 [ 4 32  1 35  0  0]
 [ 4 36  1 39  0  0]
 [ 4 40  1 43  0  0]
 [ 4 44  1 47  0  0]
 [ 4 48  1 51  0  0]]
arg.bas = [[ 0  0  5  2  0 52 57  0]
 [ 0  1  5  2  0 67 72  0]
 [ 0  2  5  1  0 82 87  0]
 [ 1  0  5  2  0 52 57  0]
 [ 1  1  5  2  0 67 72  0]
 [ 1  2  5  1  0 82 87  0]
 [ 2  0  5  2  0 52 57  0]
 [ 2  1  5  2  0 67 72  0]
 [ 2  2  5  1  0 82 87  0]
 [ 3  0  5  2  0 52 57  0]
 [ 3  1  5  2  0 67 72  0]
 [ 3  2  5  1  0 82 87  0]
 [ 4  0  5  2  0 52 57  0]
 [ 4  1  5  2  0 67 72  0]
 [ 4  2  5  1  0 82 87  0]
 [ 5  0  5  2  0 52 57  0]
 [ 5  1  5  2  0 67 72  0]
 [ 5  2  5  1  0 82 87  0]
 [ 6  0  5  2  0 52 57  0]
 [ 6  1  5  2  0 67 72  0]
 [ 6  2  5  1  0 82 87  0]
 [ 7  0  5  2  0 52 57  0]
 [ 7  1  5  2  0 67 72  0]
 [ 7  2  5  1  0 82 87  0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.14328643  0.75521952 -0.74331592
 -0.77915081 -0.08078366  1.95761895  0.29093741  0.02780209  0.48527241
  0.26332695  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225
 -1.44059548 -1.3150188  -0.76719096 -0.28600475 -0.05699711 -0.98316391
 -1.13158177 -0.64703904  0.43083118  0.15573998  5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.01465273  0.43485666  0.70818476
  0.04545847  0.04722778]
ecpbas  = []
#INFO: **** input file is /central/home/junjiey/work/fftisdf-benchmark/test/diamond-test-build-0/main.py ****
# backend to test #

import pyscf.isdf.BackEnd._config as config

config.disable_fftw()
# config.backend("numpy")
# config.backend("scipy")
config.backend("torch")
# config.backend("torch_gpu")
import pyscf.isdf.BackEnd.isdf_backend as BACKEND

# sys and pyscf #

import numpy as np
from pyscf import lib

from pyscf.lib.parameters import BOHR
from pyscf.pbc import df

# isdf util #

from pyscf.isdf.isdf_tools_Tsym import _kmesh_to_Kpoints, _1e_operator_gamma2k
from pyscf.isdf import isdf_tools_cell
from pyscf.isdf.isdf import ISDF
from pyscf.isdf.isdf_local import ISDF_Local

#############################

ke_cutoff = 70
basis = "gth-dzvp-molopt-sr"

boxlen = 3.57371000
prim_a = np.array([[boxlen, 0.0, 0.0], [0.0, boxlen, 0.0], [0.0, 0.0, boxlen]])
atm = [
    ["C", (0.0, 0.0, 0.0)],
    ["C", (0.8934275, 0.8934275, 0.8934275)],
    ["C", (1.786855, 1.786855, 0.0)],
    ["C", (2.6802825, 2.6802825, 0.8934275)],
    ["C", (1.786855, 0.0, 1.786855)],
    ["C", (2.6802825, 0.8934275, 2.6802825)],
    ["C", (0.0, 1.786855, 1.786855)],
    ["C", (0.8934275, 2.6802825, 2.6802825)],
]

kmeshes = [
    [1, 1, 1],
    [1, 1, 2],
    [1, 2, 2],
    [2, 2, 2],
    [2, 2, 4],
    [2, 4, 4],
    [4, 4, 4],
]  # -44.20339674 and -88.67568935
VERBOSE = 10

prim_cell = isdf_tools_cell.build_supercell(
    atm,
    prim_a,
    Ls=[1, 1, 1],
    ke_cutoff=ke_cutoff,
    basis=basis,
    pseudo="gth-pade",
    verbose=VERBOSE,
)

prim_group = [[0, 1], [2, 3], [4, 5], [6, 7]]

prim_mesh = prim_cell.mesh

for kmesh in kmeshes:

    mesh = [int(k * x) for k, x in zip(kmesh, prim_mesh)]
    print("kmesh:", kmesh, "mesh:", mesh)

    kpts = prim_cell.make_kpts(kmesh)

    cell, group = isdf_tools_cell.build_supercell_with_partition(
        atm,
        prim_a,
        Ls=kmesh,
        ke_cutoff=ke_cutoff,
        partition=prim_group,
        mesh=mesh,
        basis=basis,
        pseudo="gth-pade",
        verbose=VERBOSE,
    )
    
    from pyscf import __config__
    MAX_MEMORY = getattr(__config__, 'MAX_MEMORY')
    cell.max_memory = MAX_MEMORY
    print("cell:", cell.max_memory)
    print("group:", group)

    build_V_K_bunchsize = 512
    isdf = ISDF_Local(
        cell, with_robust_fitting=True, 
        limited_memory=True, 
        build_V_K_bunchsize=build_V_K_bunchsize
    )
    isdf.build(c=30, m=5, rela_cutoff=1e-4, group=group)

    from pyscf.pbc import scf

    mf = scf.RHF(cell)
    mf.with_df = isdf
    mf.max_cycle = 1
    mf.kernel()
    #INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-35-02.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 1
Python 3.12.3 | packaged by conda-forge | (main, Apr 15 2024, 18:38:13) [GCC 12.3.0]
numpy 1.26.4  scipy 1.14.1  h5py 3.12.1
Date: Mon Jan 27 15:29:21 2025
PySCF version 2.7.0
PySCF path  /home/junjiey/anaconda3/envs/fftisdf/lib/python3.12/site-packages/pyscf

[ENV] PYSCF_TMPDIR /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[ENV] PYSCF_MAX_MEMORY 491520
[ENV] PYSCF_EXT_PATH /home/junjiey/packages/pyscf-forge/pyscf-forge-yangjunjie-non-orth/
[CONFIG] ARGPARSE = False
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 491520
[CONFIG] TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = None
[INPUT] verbose = 10
[INPUT] max_memory = 2000 
[INPUT] num. atoms = 8
[INPUT] num. electrons = 32
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 C      0.893427500000   0.893427500000   0.893427500000 AA    1.688333287155   1.688333287155   1.688333287155 Bohr   0.0
[INPUT]  3 C      1.786855000000   1.786855000000   0.000000000000 AA    3.376666574310   3.376666574310   0.000000000000 Bohr   0.0
[INPUT]  4 C      2.680282500000   2.680282500000   0.893427500000 AA    5.064999861465   5.064999861465   1.688333287155 Bohr   0.0
[INPUT]  5 C      1.786855000000   0.000000000000   1.786855000000 AA    3.376666574310   0.000000000000   3.376666574310 Bohr   0.0
[INPUT]  6 C      2.680282500000   0.893427500000   2.680282500000 AA    5.064999861465   1.688333287155   5.064999861465 Bohr   0.0
[INPUT]  7 C      0.000000000000   1.786855000000   1.786855000000 AA    0.000000000000   3.376666574310   3.376666574310 Bohr   0.0
[INPUT]  8 C      0.893427500000   2.680282500000   2.680282500000 AA    1.688333287155   5.064999861465   5.064999861465 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] C
[INPUT] 0    0    [5    /2   ]  5.6053307517      0.1115328819 0.4665074832
                                2.11301639053     0.1531421941 0.1441132128
                                0.76991145481     -0.3213968794 0.0293648809
                                0.348157086385    -0.6109264216 0.9294703884
                                0.12821225471     -0.1339908628 1.0669143312
[INPUT] 1    0    [5    /2   ]  5.6053307517      -0.0648689785 -0.0554756934
                                2.11301639053     -0.2004702557 -0.2161651752
                                0.76991145481     -0.4131417301 -0.4366242723
                                0.348157086385    -0.4153371392 0.7840006984
                                0.12821225471     -0.2885276736 0.987908135
[INPUT] 2    0    [5    /1   ]  5.6053307517      0.0299527746
                                2.11301639053     0.0707844588
                                0.76991145481     0.6746010586
                                0.348157086385    0.1736520618
                                0.12821225471     1.0363170247

Ewald components = 11.6062017390159, -63.0574091279915, 0.401589778745918
nuclear repulsion = -51.0496176102297
number of shells = 24
number of NR pGTOs = 360
number of NR cGTOs = 104
basis = gth-dzvp-molopt-sr
ecp = {}
bas 0, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 1, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 2, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 3, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 4, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 5, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 6, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 7, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 8, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 9, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 10, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 11, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 12, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 13, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 14, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 15, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 16, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 17, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 18, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 19, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 20, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 21, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 22, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 23, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
CPU time:         9.47
lattice vectors  a1 [6.753333149, 0.000000000, 0.000000000]
                 a2 [0.000000000, 6.753333149, 0.000000000]
                 a3 [0.000000000, 0.000000000, 6.753333149]
dimension = 3
low_dim_ft_type = None
Cell volume = 308.003
rcut = 22.25045319935835 (nimgs = [4 4 4])
lattice sum = 899 cells
precision = 1e-08
pseudo = gth-pade
mesh = [27, 27, 27] (19683 PWs)
    = ke_cutoff [73.14423411 73.14423411 73.14423411]
cell: 491520
group: [[0, 1], [2, 3], [4, 5], [6, 7]]
ISDF: mol.ke_cutoff = 70.000000
ISDF: mol.natm      = 8
ISDF: mol.nao       = 104
************* get_partition *************
************* end get_partition *************
       get_partition wall time:     0.103544 CPU time:     0.103015
len of partition[   0] =   2677
len of partition[   1] =   2267
len of partition[   2] =   2692
len of partition[   3] =   2268
len of partition[   4] =   2659
len of partition[   5] =   2252
len of partition[   6] =   2633
len of partition[   7] =   2235
************* get_aoR *************
************* end get_aoR *************
             get_aoR wall time:     3.036170 CPU time:     3.021699
In _build_buffer: ISDF Local size of buffer = 80.502 MB
 ---------- In pyscf.isdf.isdf_local.select_IP_local_atm ----------
select_IP_local_atm: atm_begin =    0, atm_end =    8
select_IP_local_atm: npt_found =  516
select_IP_local_atm: npt_found =  473
select_IP_local_atm: npt_found =  486
select_IP_local_atm: npt_found =  480
select_IP_local_atm: npt_found =  507
select_IP_local_atm: npt_found =  465
select_IP_local_atm: npt_found =  498
select_IP_local_atm: npt_found =  475
select_IP_local_step1 wall time:     1.092932 CPU time:    68.389681
 build_aoRg_possible wall time:     0.003503 CPU time:     0.254798
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  989
select_IP_local_group: npt_found =  782
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  966
select_IP_local_group: npt_found =  787
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  972
select_IP_local_group: npt_found =  799
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  973
select_IP_local_group: npt_found =  796
select_IP_local_step2 wall time:     0.334029 CPU time:    21.318216
select_IP_local_step3 wall time:     0.023390 CPU time:     1.468234
Memory usage for aoR  :     15.624 MB
Memory usage for aoRg :      2.517 MB
            build_IP wall time:     1.453854 CPU time:    91.430928
build_aux_basis_local wall time:     0.162174 CPU time:    10.329689
 ---------- In pyscf.isdf.isdf_local.build_V_W_local ----------
Memory usage for V:    475.136 MB
Memory usage for W:     76.377 MB
     build_V_W_local wall time:     2.633067 CPU time:    43.414285


******** <class 'pyscf.pbc.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 1
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /central/scratch/yangjunjie/diamond-test-build-0/46998083/tmplejoeh0a
max_memory 491520 MB (current use 1474 MB)
******** PBC SCF flags ********
kpt = [0. 0. 0.]
Exchange divergence treatment (exxdiv) = ewald
Ewald components = 0.000105727067579829, -0.251544692466148, 0.0413725125048105
    madelung (= occupied orbital energy shift) = 0.42013290578751533
    Total energy shift due to Ewald probe charge = -1/2 * Nelec*madelung = -6.7221264926
DF object = <pyscf.isdf.isdf_local.ISDF_Local object at 0x7f94f1673470>
Set gradient conv threshold to 0.000316228
Initial guess from minao.
Big error detected in the electron number of initial guess density matrix (Ne/cell = 31.4598)!
  This can cause huge error in Fock matrix and lead to instability in SCF for low-dimensional systems.
  DM is normalized wrt the number of electrons 32
arg.atm = [[ 4 20  1 23  0  0]
 [ 4 24  1 27  0  0]
 [ 4 28  1 31  0  0]
 [ 4 32  1 35  0  0]
 [ 4 36  1 39  0  0]
 [ 4 40  1 43  0  0]
 [ 4 44  1 47  0  0]
 [ 4 48  1 51  0  0]]
arg.bas = [[ 0  0  5  2  0 52 57  0]
 [ 0  1  5  2  0 67 72  0]
 [ 0  2  5  1  0 82 87  0]
 [ 1  0  5  2  0 52 57  0]
 [ 1  1  5  2  0 67 72  0]
 [ 1  2  5  1  0 82 87  0]
 [ 2  0  5  2  0 52 57  0]
 [ 2  1  5  2  0 67 72  0]
 [ 2  2  5  1  0 82 87  0]
 [ 3  0  5  2  0 52 57  0]
 [ 3  1  5  2  0 67 72  0]
 [ 3  2  5  1  0 82 87  0]
 [ 4  0  5  2  0 52 57  0]
 [ 4  1  5  2  0 67 72  0]
 [ 4  2  5  1  0 82 87  0]
 [ 5  0  5  2  0 52 57  0]
 [ 5  1  5  2  0 67 72  0]
 [ 5  2  5  1  0 82 87  0]
 [ 6  0  5  2  0 52 57  0]
 [ 6  1  5  2  0 67 72  0]
 [ 6  2  5  1  0 82 87  0]
 [ 7  0  5  2  0 52 57  0]
 [ 7  1  5  2  0 67 72  0]
 [ 7  2  5  1  0 82 87  0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.14328643  0.75521952 -0.74331592
 -0.77915081 -0.08078366  1.95761895  0.29093741  0.02780209  0.48527241
  0.26332695  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225
 -1.44059548 -1.3150188  -0.76719096 -0.28600475 -0.05699711 -0.98316391
 -1.13158177 -0.64703904  0.43083118  0.15573998  5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.01465273  0.43485666  0.70818476
  0.04545847  0.04722778]
ecpbas  = []
    CPU time for pbc integral int3c1e_sph      9.45 sec, wall time      2.31 sec
    CPU time for pbc integral int3c1e_r2_origk_sph      2.80 sec, wall time      2.80 sec
ke_cutoff for multigrid tasks:
[2.5925925925925926, 7.777777777777778, 23.333333333333332, 70]
meshes for multigrid tasks:
[array([7, 7, 7]), array([11, 11, 11]), array([17, 17, 17]), array([27, 27, 27])]
              get_pp wall time:     7.419879 CPU time:    15.168092
Building PBC AO integrals incore
      isdf_local_eri wall time:     4.975959 CPU time:   286.471464
Ewald components = 0.000105727067579829, -0.251544692466148, 0.0413725125048105
    CPU time for vj and vk    286.92 sec, wall time      5.42 sec
E1 = 16.528905470094088  E_coul = -10.154217891385054
init E= -44.6749300315207
    CPU time for initialize scf    308.25 sec, wall time     13.31 sec
  HOMO = 0.641611099357131  LUMO = 0.828023827230912
  mo_energy =
[-1.41408552 -0.36385817 -0.36385703 -0.36385703 -0.36385703 -0.36385646
 -0.36385646  0.28267443  0.28267443  0.28267443  0.28267773  0.28267773
  0.28267773  0.6416111   0.6416111   0.6416111   0.82802383  0.82802429
  0.82802429  0.82802429  0.82802452  0.82802453  0.90869475  0.90869475
  0.90869475  1.13843437  1.42986754  1.42986754  1.42986754  1.42987849
  1.42987849  1.42987849  1.769873    1.769873    1.76987307  1.76987307
  1.76987307  1.76987319  1.92680508  1.92680508  2.22371549  2.22371549
  2.22371549  2.22372384  2.22372384  2.22372384  2.46656897  2.46656897
  2.46656897  2.5808945   2.5808945   2.58090255  2.58090255  2.58090255
  2.58091863  2.73639513  2.73639513  2.73639513  3.00859202  3.00859202
  3.00859202  3.00861132  3.00861132  3.00861132  3.18823809  3.18824283
  3.18824283  3.18824283  3.18824519  3.18824519  3.3006933   3.3006933
  3.3006933   3.30070797  3.30070798  3.30070798  3.75065492  3.75066104
  3.75066104  3.75066105  3.7506641   3.7506641   3.86100964  3.86100964
  4.04632884  4.04632885  4.04632885  4.95300299  4.95300301  4.95300302
  5.04555516  5.04555517  5.04555517  5.04556549  5.04556553  5.04556555
  7.04615424  9.43183891  9.506841    9.50696606  9.50696606  9.50696606
  9.50702863  9.50702863]
Ewald components = 0.000105727067579829, -0.251544692466148, 0.0413725125048105
    CPU time for vj and vk      7.87 sec, wall time      0.25 sec
E1 = 15.963897763533312  E_coul = -9.071112132284451
cycle= 1 E= -44.1568319789809  delta_E= 0.518  |g|= 0.479  |ddm|= 5.89
    CPU time for cycle= 1      8.33 sec, wall time      0.26 sec
    CPU time for scf_cycle    316.57 sec, wall time     13.57 sec
    CPU time for SCF    320.66 sec, wall time     13.87 sec
SCF not converged.
SCF energy = -44.1568319789809
kmesh: [1, 1, 2] mesh: [27, 27, 54]
arg.atm = [[ 4 20  1 23  0  0]
 [ 4 24  1 27  0  0]
 [ 4 28  1 31  0  0]
 [ 4 32  1 35  0  0]
 [ 4 36  1 39  0  0]
 [ 4 40  1 43  0  0]
 [ 4 44  1 47  0  0]
 [ 4 48  1 51  0  0]
 [ 4 52  1 55  0  0]
 [ 4 56  1 59  0  0]
 [ 4 60  1 63  0  0]
 [ 4 64  1 67  0  0]
 [ 4 68  1 71  0  0]
 [ 4 72  1 75  0  0]
 [ 4 76  1 79  0  0]
 [ 4 80  1 83  0  0]]
arg.bas = [[  0   0   5   2   0  84  89   0]
 [  0   1   5   2   0  99 104   0]
 [  0   2   5   1   0 114 119   0]
 [  1   0   5   2   0  84  89   0]
 [  1   1   5   2   0  99 104   0]
 [  1   2   5   1   0 114 119   0]
 [  2   0   5   2   0  84  89   0]
 [  2   1   5   2   0  99 104   0]
 [  2   2   5   1   0 114 119   0]
 [  3   0   5   2   0  84  89   0]
 [  3   1   5   2   0  99 104   0]
 [  3   2   5   1   0 114 119   0]
 [  4   0   5   2   0  84  89   0]
 [  4   1   5   2   0  99 104   0]
 [  4   2   5   1   0 114 119   0]
 [  5   0   5   2   0  84  89   0]
 [  5   1   5   2   0  99 104   0]
 [  5   2   5   1   0 114 119   0]
 [  6   0   5   2   0  84  89   0]
 [  6   1   5   2   0  99 104   0]
 [  6   2   5   1   0 114 119   0]
 [  7   0   5   2   0  84  89   0]
 [  7   1   5   2   0  99 104   0]
 [  7   2   5   1   0 114 119   0]
 [  8   0   5   2   0  84  89   0]
 [  8   1   5   2   0  99 104   0]
 [  8   2   5   1   0 114 119   0]
 [  9   0   5   2   0  84  89   0]
 [  9   1   5   2   0  99 104   0]
 [  9   2   5   1   0 114 119   0]
 [ 10   0   5   2   0  84  89   0]
 [ 10   1   5   2   0  99 104   0]
 [ 10   2   5   1   0 114 119   0]
 [ 11   0   5   2   0  84  89   0]
 [ 11   1   5   2   0  99 104   0]
 [ 11   2   5   1   0 114 119   0]
 [ 12   0   5   2   0  84  89   0]
 [ 12   1   5   2   0  99 104   0]
 [ 12   2   5   1   0 114 119   0]
 [ 13   0   5   2   0  84  89   0]
 [ 13   1   5   2   0  99 104   0]
 [ 13   2   5   1   0 114 119   0]
 [ 14   0   5   2   0  84  89   0]
 [ 14   1   5   2   0  99 104   0]
 [ 14   2   5   1   0 114 119   0]
 [ 15   0   5   2   0  84  89   0]
 [ 15   1   5   2   0  99 104   0]
 [ 15   2   5   1   0 114 119   0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          0.          0.
  6.75333315  0.          1.68833329  1.68833329  8.44166644  0.
  3.37666657  3.37666657  6.75333315  0.          5.06499986  5.06499986
  8.44166644  0.          3.37666657  0.         10.12999972  0.
  5.06499986  1.68833329 11.81833301  0.          0.          3.37666657
 10.12999972  0.          1.68833329  5.06499986 11.81833301  0.
  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225  1.14328643
  0.75521952 -0.74331592 -0.77915081 -0.08078366  1.95761895  0.29093741
  0.02780209  0.48527241  0.26332695  5.60533075  2.11301639  0.76991145
  0.34815709  0.12821225 -1.44059548 -1.3150188  -0.76719096 -0.28600475
 -0.05699711 -0.98316391 -1.13158177 -0.64703904  0.43083118  0.15573998
  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225  1.01465273
  0.43485666  0.70818476  0.04545847  0.04722778]
ecpbas  = []
#INFO: **** input file is /central/home/junjiey/work/fftisdf-benchmark/test/diamond-test-build-0/main.py ****
# backend to test #

import pyscf.isdf.BackEnd._config as config

config.disable_fftw()
# config.backend("numpy")
# config.backend("scipy")
config.backend("torch")
# config.backend("torch_gpu")
import pyscf.isdf.BackEnd.isdf_backend as BACKEND

# sys and pyscf #

import numpy as np
from pyscf import lib

from pyscf.lib.parameters import BOHR
from pyscf.pbc import df

# isdf util #

from pyscf.isdf.isdf_tools_Tsym import _kmesh_to_Kpoints, _1e_operator_gamma2k
from pyscf.isdf import isdf_tools_cell
from pyscf.isdf.isdf import ISDF
from pyscf.isdf.isdf_local import ISDF_Local

#############################

ke_cutoff = 70
basis = "gth-dzvp-molopt-sr"

boxlen = 3.57371000
prim_a = np.array([[boxlen, 0.0, 0.0], [0.0, boxlen, 0.0], [0.0, 0.0, boxlen]])
atm = [
    ["C", (0.0, 0.0, 0.0)],
    ["C", (0.8934275, 0.8934275, 0.8934275)],
    ["C", (1.786855, 1.786855, 0.0)],
    ["C", (2.6802825, 2.6802825, 0.8934275)],
    ["C", (1.786855, 0.0, 1.786855)],
    ["C", (2.6802825, 0.8934275, 2.6802825)],
    ["C", (0.0, 1.786855, 1.786855)],
    ["C", (0.8934275, 2.6802825, 2.6802825)],
]

kmeshes = [
    [1, 1, 1],
    [1, 1, 2],
    [1, 2, 2],
    [2, 2, 2],
    [2, 2, 4],
    [2, 4, 4],
    [4, 4, 4],
]  # -44.20339674 and -88.67568935
VERBOSE = 10

prim_cell = isdf_tools_cell.build_supercell(
    atm,
    prim_a,
    Ls=[1, 1, 1],
    ke_cutoff=ke_cutoff,
    basis=basis,
    pseudo="gth-pade",
    verbose=VERBOSE,
)

prim_group = [[0, 1], [2, 3], [4, 5], [6, 7]]

prim_mesh = prim_cell.mesh

for kmesh in kmeshes:

    mesh = [int(k * x) for k, x in zip(kmesh, prim_mesh)]
    print("kmesh:", kmesh, "mesh:", mesh)

    kpts = prim_cell.make_kpts(kmesh)

    cell, group = isdf_tools_cell.build_supercell_with_partition(
        atm,
        prim_a,
        Ls=kmesh,
        ke_cutoff=ke_cutoff,
        partition=prim_group,
        mesh=mesh,
        basis=basis,
        pseudo="gth-pade",
        verbose=VERBOSE,
    )
    
    from pyscf import __config__
    MAX_MEMORY = getattr(__config__, 'MAX_MEMORY')
    cell.max_memory = MAX_MEMORY
    print("cell:", cell.max_memory)
    print("group:", group)

    build_V_K_bunchsize = 512
    isdf = ISDF_Local(
        cell, with_robust_fitting=True, 
        limited_memory=True, 
        build_V_K_bunchsize=build_V_K_bunchsize
    )
    isdf.build(c=30, m=5, rela_cutoff=1e-4, group=group)

    from pyscf.pbc import scf

    mf = scf.RHF(cell)
    mf.with_df = isdf
    mf.max_cycle = 1
    mf.kernel()
    #INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-35-02.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 1
Python 3.12.3 | packaged by conda-forge | (main, Apr 15 2024, 18:38:13) [GCC 12.3.0]
numpy 1.26.4  scipy 1.14.1  h5py 3.12.1
Date: Mon Jan 27 15:29:42 2025
PySCF version 2.7.0
PySCF path  /home/junjiey/anaconda3/envs/fftisdf/lib/python3.12/site-packages/pyscf

[ENV] PYSCF_TMPDIR /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[ENV] PYSCF_MAX_MEMORY 491520
[ENV] PYSCF_EXT_PATH /home/junjiey/packages/pyscf-forge/pyscf-forge-yangjunjie-non-orth/
[CONFIG] ARGPARSE = False
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 491520
[CONFIG] TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = None
[INPUT] verbose = 10
[INPUT] max_memory = 2000 
[INPUT] num. atoms = 16
[INPUT] num. electrons = 64
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 C      0.893427500000   0.893427500000   0.893427500000 AA    1.688333287155   1.688333287155   1.688333287155 Bohr   0.0
[INPUT]  3 C      1.786855000000   1.786855000000   0.000000000000 AA    3.376666574310   3.376666574310   0.000000000000 Bohr   0.0
[INPUT]  4 C      2.680282500000   2.680282500000   0.893427500000 AA    5.064999861465   5.064999861465   1.688333287155 Bohr   0.0
[INPUT]  5 C      1.786855000000   0.000000000000   1.786855000000 AA    3.376666574310   0.000000000000   3.376666574310 Bohr   0.0
[INPUT]  6 C      2.680282500000   0.893427500000   2.680282500000 AA    5.064999861465   1.688333287155   5.064999861465 Bohr   0.0
[INPUT]  7 C      0.000000000000   1.786855000000   1.786855000000 AA    0.000000000000   3.376666574310   3.376666574310 Bohr   0.0
[INPUT]  8 C      0.893427500000   2.680282500000   2.680282500000 AA    1.688333287155   5.064999861465   5.064999861465 Bohr   0.0
[INPUT]  9 C      0.000000000000   0.000000000000   3.573710000000 AA    0.000000000000   0.000000000000   6.753333148619 Bohr   0.0
[INPUT] 10 C      0.893427500000   0.893427500000   4.467137500000 AA    1.688333287155   1.688333287155   8.441666435774 Bohr   0.0
[INPUT] 11 C      1.786855000000   1.786855000000   3.573710000000 AA    3.376666574310   3.376666574310   6.753333148619 Bohr   0.0
[INPUT] 12 C      2.680282500000   2.680282500000   4.467137500000 AA    5.064999861465   5.064999861465   8.441666435774 Bohr   0.0
[INPUT] 13 C      1.786855000000   0.000000000000   5.360565000000 AA    3.376666574310   0.000000000000  10.129999722929 Bohr   0.0
[INPUT] 14 C      2.680282500000   0.893427500000   6.253992500000 AA    5.064999861465   1.688333287155  11.818333010084 Bohr   0.0
[INPUT] 15 C      0.000000000000   1.786855000000   5.360565000000 AA    0.000000000000   3.376666574310  10.129999722929 Bohr   0.0
[INPUT] 16 C      0.893427500000   2.680282500000   6.253992500000 AA    1.688333287155   5.064999861465  11.818333010084 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] C
[INPUT] 0    0    [5    /2   ]  5.6053307517      0.1115328819 0.4665074832
                                2.11301639053     0.1531421941 0.1441132128
                                0.76991145481     -0.3213968794 0.0293648809
                                0.348157086385    -0.6109264216 0.9294703884
                                0.12821225471     -0.1339908628 1.0669143312
[INPUT] 1    0    [5    /2   ]  5.6053307517      -0.0648689785 -0.0554756934
                                2.11301639053     -0.2004702557 -0.2161651752
                                0.76991145481     -0.4131417301 -0.4366242723
                                0.348157086385    -0.4153371392 0.7840006984
                                0.12821225471     -0.2885276736 0.987908135
[INPUT] 2    0    [5    /1   ]  5.6053307517      0.0299527746
                                2.11301639053     0.0707844588
                                0.76991145481     0.6746010586
                                0.348157086385    0.1736520618
                                0.12821225471     1.0363170247

Ewald components = 36.0289989359732, -138.385048104828, 0.256813947419847
nuclear repulsion = -102.099235221435
number of shells = 48
number of NR pGTOs = 720
number of NR cGTOs = 208
basis = gth-dzvp-molopt-sr
ecp = {}
bas 0, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 1, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 2, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 3, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 4, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 5, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 6, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 7, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 8, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 9, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 10, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 11, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 12, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 13, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 14, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 15, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 16, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 17, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 18, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 19, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 20, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 21, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 22, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 23, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 24, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 25, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 26, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 27, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 28, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 29, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 30, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 31, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 32, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 33, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 34, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 35, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 36, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 37, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 38, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 39, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 40, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 41, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 42, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 43, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 44, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 45, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 46, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 47, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
CPU time:       479.74
lattice vectors  a1 [6.753333149, 0.000000000, 0.000000000]
                 a2 [0.000000000, 6.753333149, 0.000000000]
                 a3 [0.000000000, 0.000000000, 13.506666297]
dimension = 3
low_dim_ft_type = None
Cell volume = 616.005
rcut = 22.25045319935835 (nimgs = [4 4 2])
lattice sum = 623 cells
precision = 1e-08
pseudo = gth-pade
mesh = [27, 27, 54] (39366 PWs)
    = ke_cutoff [73.14423411 73.14423411 73.14423411]
cell: 491520
group: [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11], [12, 13], [14, 15]]
ISDF: mol.ke_cutoff = 70.000000
ISDF: mol.natm      = 16
ISDF: mol.nao       = 208
************* get_partition *************
************* end get_partition *************
       get_partition wall time:     0.146396 CPU time:     5.416053
len of partition[   0] =   2677
len of partition[   1] =   2254
len of partition[   2] =   2675
len of partition[   3] =   2255
len of partition[   4] =   2678
len of partition[   5] =   2264
len of partition[   6] =   2646
len of partition[   7] =   2247
len of partition[   8] =   2677
len of partition[   9] =   2255
len of partition[  10] =   2646
len of partition[  11] =   2252
len of partition[  12] =   2678
len of partition[  13] =   2267
len of partition[  14] =   2645
len of partition[  15] =   2250
************* get_aoR *************
************* end get_aoR *************
             get_aoR wall time:     4.109671 CPU time:     4.102576
In _build_buffer: ISDF Local size of buffer = 161.829 MB
 ---------- In pyscf.isdf.isdf_local.select_IP_local_atm ----------
select_IP_local_atm: atm_begin =    0, atm_end =   16
select_IP_local_atm: npt_found =  514
select_IP_local_atm: npt_found =  484
select_IP_local_atm: npt_found =  511
select_IP_local_atm: npt_found =  462
select_IP_local_atm: npt_found =  494
select_IP_local_atm: npt_found =  471
select_IP_local_atm: npt_found =  508
select_IP_local_atm: npt_found =  484
select_IP_local_atm: npt_found =  501
select_IP_local_atm: npt_found =  470
select_IP_local_atm: npt_found =  479
select_IP_local_atm: npt_found =  502
select_IP_local_atm: npt_found =  492
select_IP_local_atm: npt_found =  473
select_IP_local_atm: npt_found =  513
select_IP_local_atm: npt_found =  456
select_IP_local_step1 wall time:     1.682374 CPU time:   107.128832
 build_aoRg_possible wall time:     0.011730 CPU time:     0.702689
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  998
select_IP_local_group: npt_found =  787
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  973
select_IP_local_group: npt_found =  806
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  965
select_IP_local_group: npt_found =  792
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  992
select_IP_local_group: npt_found =  817
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  971
select_IP_local_group: npt_found =  773
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  981
select_IP_local_group: npt_found =  791
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  965
select_IP_local_group: npt_found =  796
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  969
select_IP_local_group: npt_found =  805
select_IP_local_step2 wall time:     0.639274 CPU time:    40.854019
select_IP_local_step3 wall time:     0.051464 CPU time:     3.256614
Memory usage for aoR  :     62.496 MB
Memory usage for aoRg :     10.129 MB
            build_IP wall time:     2.384841 CPU time:   151.942155
build_aux_basis_local wall time:     0.348200 CPU time:    22.206027
 ---------- In pyscf.isdf.isdf_local.build_V_W_local ----------
Memory usage for V:   1912.257 MB
Memory usage for W:    309.286 MB
     build_V_W_local wall time:     9.551576 CPU time:    95.381091


******** <class 'pyscf.pbc.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 1
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /central/scratch/yangjunjie/diamond-test-build-0/46998083/tmpbws126xc
max_memory 491520 MB (current use 3679 MB)
******** PBC SCF flags ********
kpt = [0. 0. 0.]
Exchange divergence treatment (exxdiv) = ewald
Ewald components = 0.000314592933934792, -0.215113710861397, 0.081099078945861
    madelung (= occupied orbital energy shift) = 0.2674000779632031
    Total energy shift due to Ewald probe charge = -1/2 * Nelec*madelung = -8.55680249482
DF object = <pyscf.isdf.isdf_local.ISDF_Local object at 0x7f94e90baa20>
Set gradient conv threshold to 0.000316228
Initial guess from minao.
Big error detected in the electron number of initial guess density matrix (Ne/cell = 63.3632)!
  This can cause huge error in Fock matrix and lead to instability in SCF for low-dimensional systems.
  DM is normalized wrt the number of electrons 64
arg.atm = [[ 4 20  1 23  0  0]
 [ 4 24  1 27  0  0]
 [ 4 28  1 31  0  0]
 [ 4 32  1 35  0  0]
 [ 4 36  1 39  0  0]
 [ 4 40  1 43  0  0]
 [ 4 44  1 47  0  0]
 [ 4 48  1 51  0  0]
 [ 4 52  1 55  0  0]
 [ 4 56  1 59  0  0]
 [ 4 60  1 63  0  0]
 [ 4 64  1 67  0  0]
 [ 4 68  1 71  0  0]
 [ 4 72  1 75  0  0]
 [ 4 76  1 79  0  0]
 [ 4 80  1 83  0  0]]
arg.bas = [[  0   0   5   2   0  84  89   0]
 [  0   1   5   2   0  99 104   0]
 [  0   2   5   1   0 114 119   0]
 [  1   0   5   2   0  84  89   0]
 [  1   1   5   2   0  99 104   0]
 [  1   2   5   1   0 114 119   0]
 [  2   0   5   2   0  84  89   0]
 [  2   1   5   2   0  99 104   0]
 [  2   2   5   1   0 114 119   0]
 [  3   0   5   2   0  84  89   0]
 [  3   1   5   2   0  99 104   0]
 [  3   2   5   1   0 114 119   0]
 [  4   0   5   2   0  84  89   0]
 [  4   1   5   2   0  99 104   0]
 [  4   2   5   1   0 114 119   0]
 [  5   0   5   2   0  84  89   0]
 [  5   1   5   2   0  99 104   0]
 [  5   2   5   1   0 114 119   0]
 [  6   0   5   2   0  84  89   0]
 [  6   1   5   2   0  99 104   0]
 [  6   2   5   1   0 114 119   0]
 [  7   0   5   2   0  84  89   0]
 [  7   1   5   2   0  99 104   0]
 [  7   2   5   1   0 114 119   0]
 [  8   0   5   2   0  84  89   0]
 [  8   1   5   2   0  99 104   0]
 [  8   2   5   1   0 114 119   0]
 [  9   0   5   2   0  84  89   0]
 [  9   1   5   2   0  99 104   0]
 [  9   2   5   1   0 114 119   0]
 [ 10   0   5   2   0  84  89   0]
 [ 10   1   5   2   0  99 104   0]
 [ 10   2   5   1   0 114 119   0]
 [ 11   0   5   2   0  84  89   0]
 [ 11   1   5   2   0  99 104   0]
 [ 11   2   5   1   0 114 119   0]
 [ 12   0   5   2   0  84  89   0]
 [ 12   1   5   2   0  99 104   0]
 [ 12   2   5   1   0 114 119   0]
 [ 13   0   5   2   0  84  89   0]
 [ 13   1   5   2   0  99 104   0]
 [ 13   2   5   1   0 114 119   0]
 [ 14   0   5   2   0  84  89   0]
 [ 14   1   5   2   0  99 104   0]
 [ 14   2   5   1   0 114 119   0]
 [ 15   0   5   2   0  84  89   0]
 [ 15   1   5   2   0  99 104   0]
 [ 15   2   5   1   0 114 119   0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          0.          0.
  6.75333315  0.          1.68833329  1.68833329  8.44166644  0.
  3.37666657  3.37666657  6.75333315  0.          5.06499986  5.06499986
  8.44166644  0.          3.37666657  0.         10.12999972  0.
  5.06499986  1.68833329 11.81833301  0.          0.          3.37666657
 10.12999972  0.          1.68833329  5.06499986 11.81833301  0.
  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225  1.14328643
  0.75521952 -0.74331592 -0.77915081 -0.08078366  1.95761895  0.29093741
  0.02780209  0.48527241  0.26332695  5.60533075  2.11301639  0.76991145
  0.34815709  0.12821225 -1.44059548 -1.3150188  -0.76719096 -0.28600475
 -0.05699711 -0.98316391 -1.13158177 -0.64703904  0.43083118  0.15573998
  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225  1.01465273
  0.43485666  0.70818476  0.04545847  0.04722778]
ecpbas  = []
    CPU time for pbc integral int3c1e_sph     10.89 sec, wall time      4.53 sec
    CPU time for pbc integral int3c1e_r2_origk_sph      5.49 sec, wall time      5.50 sec
ke_cutoff for multigrid tasks:
[2.5925925925925926, 7.777777777777778, 23.333333333333332, 70]
meshes for multigrid tasks:
[array([ 7,  7, 11]), array([11, 11, 19]), array([17, 17, 31]), array([27, 27, 53])]
              get_pp wall time:    14.915510 CPU time:    22.930689
Building PBC AO integrals incore
      isdf_local_eri wall time:    76.041978 CPU time:  3252.955854
Ewald components = 0.000314592933934792, -0.215113710861397, 0.081099078945861
    CPU time for vj and vk   3256.85 sec, wall time     79.94 sec
E1 = 33.04249055970457  E_coul = -19.996793475113822
init E= -89.0535381368445
    CPU time for initialize scf   3286.55 sec, wall time     95.83 sec
  HOMO = 0.640143368817195  LUMO = 0.817569858638195
  mo_energy =
[-1.36220037 -1.08123412 -1.08123407 -0.38926943 -0.38926943 -0.33585254
 -0.33585249 -0.33585249 -0.33585245 -0.29088409 -0.29088404 -0.29088404
 -0.29088399  0.14477883  0.14477886  0.14477886  0.14477888  0.27024057
  0.27024061  0.27024061  0.27024064  0.28442853  0.28442858  0.29590445
  0.29590445  0.41879592  0.41879592  0.41879594  0.41879594  0.6321309
  0.64014337  0.64014337  0.81756986  0.81756988  0.81756988  0.8175699
  0.82419639  0.82419643  0.82610699  0.82610699  0.90326372  0.90326372
  0.90512141  1.10552655  1.10552656  1.13497264  1.15065073  1.15065081
  1.15065081  1.15065088  1.18129129  1.18129131  1.18129131  1.18129133
  1.18813642  1.18813642  1.18813646  1.18813646  1.42629258  1.42629258
  1.42740676  1.42740688  1.42740688  1.42740694  1.59270397  1.59270399
  1.6685178   1.66851781  1.66851781  1.66851782  1.76434653  1.76434653
  1.76589017  1.76589017  1.76589017  1.76589018  1.81719766  1.81719786
  1.92169828  1.92778215  2.08857054  2.08857055  2.21037989  2.21037995
  2.21037996  2.21038002  2.22068242  2.22068242  2.22130847  2.22130854
  2.22130854  2.22130855  2.46329163  2.46329163  2.46428246  2.49537127
  2.49537127  2.4953713   2.49537131  2.57819287  2.57819321  2.57819321
  2.57819338  2.57898072  2.57898088  2.6641098   2.66410981  2.66410984
  2.66410984  2.73300568  2.73326221  2.73326221  2.73831742  2.7383175
  2.7383175   2.73831757  2.94036735  2.94036735  3.00528688  3.00528688
  3.00528715  3.00528737  3.00553622  3.00553622  3.05764876  3.05764879
  3.05764879  3.05764881  3.06699512  3.06699526  3.06699526  3.06699541
  3.18564092  3.18564099  3.18581051  3.18581051  3.18581054  3.18581054
  3.25357664  3.25357682  3.26068367  3.26068378  3.26068379  3.26068391
  3.29796624  3.29796624  3.29834115  3.29834128  3.29834136  3.29834136
  3.3516579   3.35165792  3.61369086  3.61369087  3.61369088  3.61369089
  3.67917375  3.67917443  3.72002353  3.72002354  3.72002359  3.72002359
  3.74819536  3.74819626  3.74819636  3.74819636  3.74821264  3.74821373
  3.85815867  3.85849604  4.01782944  4.01782973  4.0432748   4.04398786
  4.04398786  4.89815861  4.89815869  4.8981587   4.89815876  4.95021634
  4.95021636  4.95028434  5.01599639  5.01599639  5.01599645  5.01599649
  5.0429372   5.0429372   5.04293748  5.04293767  5.04300773  5.04300775
  7.04045506  9.23651232  9.2365126   9.42563577  9.46475576  9.46475874
  9.46475874  9.46475908  9.46751097  9.46751337  9.50061457  9.50069874
  9.50070765  9.50070765  9.50070776  9.50079176]
Ewald components = 0.000314592933934792, -0.215113710861397, 0.081099078945861
    CPU time for vj and vk      9.73 sec, wall time      2.15 sec
E1 = 31.74655140944677  E_coul = -18.159053869033176
cycle= 1 E= -88.5117376810216  delta_E= 0.542  |g|= 0.748  |ddm|= 7.81
    CPU time for cycle= 1     10.54 sec, wall time      2.16 sec
    CPU time for scf_cycle   3297.09 sec, wall time     97.99 sec
    CPU time for SCF   3301.37 sec, wall time     98.53 sec
SCF not converged.
SCF energy = -88.5117376810216
kmesh: [1, 2, 2] mesh: [27, 54, 54]
arg.atm = [[  4  20   1  23   0   0]
 [  4  24   1  27   0   0]
 [  4  28   1  31   0   0]
 [  4  32   1  35   0   0]
 [  4  36   1  39   0   0]
 [  4  40   1  43   0   0]
 [  4  44   1  47   0   0]
 [  4  48   1  51   0   0]
 [  4  52   1  55   0   0]
 [  4  56   1  59   0   0]
 [  4  60   1  63   0   0]
 [  4  64   1  67   0   0]
 [  4  68   1  71   0   0]
 [  4  72   1  75   0   0]
 [  4  76   1  79   0   0]
 [  4  80   1  83   0   0]
 [  4  84   1  87   0   0]
 [  4  88   1  91   0   0]
 [  4  92   1  95   0   0]
 [  4  96   1  99   0   0]
 [  4 100   1 103   0   0]
 [  4 104   1 107   0   0]
 [  4 108   1 111   0   0]
 [  4 112   1 115   0   0]
 [  4 116   1 119   0   0]
 [  4 120   1 123   0   0]
 [  4 124   1 127   0   0]
 [  4 128   1 131   0   0]
 [  4 132   1 135   0   0]
 [  4 136   1 139   0   0]
 [  4 140   1 143   0   0]
 [  4 144   1 147   0   0]]
arg.bas = [[  0   0   5   2   0 148 153   0]
 [  0   1   5   2   0 163 168   0]
 [  0   2   5   1   0 178 183   0]
 [  1   0   5   2   0 148 153   0]
 [  1   1   5   2   0 163 168   0]
 [  1   2   5   1   0 178 183   0]
 [  2   0   5   2   0 148 153   0]
 [  2   1   5   2   0 163 168   0]
 [  2   2   5   1   0 178 183   0]
 [  3   0   5   2   0 148 153   0]
 [  3   1   5   2   0 163 168   0]
 [  3   2   5   1   0 178 183   0]
 [  4   0   5   2   0 148 153   0]
 [  4   1   5   2   0 163 168   0]
 [  4   2   5   1   0 178 183   0]
 [  5   0   5   2   0 148 153   0]
 [  5   1   5   2   0 163 168   0]
 [  5   2   5   1   0 178 183   0]
 [  6   0   5   2   0 148 153   0]
 [  6   1   5   2   0 163 168   0]
 [  6   2   5   1   0 178 183   0]
 [  7   0   5   2   0 148 153   0]
 [  7   1   5   2   0 163 168   0]
 [  7   2   5   1   0 178 183   0]
 [  8   0   5   2   0 148 153   0]
 [  8   1   5   2   0 163 168   0]
 [  8   2   5   1   0 178 183   0]
 [  9   0   5   2   0 148 153   0]
 [  9   1   5   2   0 163 168   0]
 [  9   2   5   1   0 178 183   0]
 [ 10   0   5   2   0 148 153   0]
 [ 10   1   5   2   0 163 168   0]
 [ 10   2   5   1   0 178 183   0]
 [ 11   0   5   2   0 148 153   0]
 [ 11   1   5   2   0 163 168   0]
 [ 11   2   5   1   0 178 183   0]
 [ 12   0   5   2   0 148 153   0]
 [ 12   1   5   2   0 163 168   0]
 [ 12   2   5   1   0 178 183   0]
 [ 13   0   5   2   0 148 153   0]
 [ 13   1   5   2   0 163 168   0]
 [ 13   2   5   1   0 178 183   0]
 [ 14   0   5   2   0 148 153   0]
 [ 14   1   5   2   0 163 168   0]
 [ 14   2   5   1   0 178 183   0]
 [ 15   0   5   2   0 148 153   0]
 [ 15   1   5   2   0 163 168   0]
 [ 15   2   5   1   0 178 183   0]
 [ 16   0   5   2   0 148 153   0]
 [ 16   1   5   2   0 163 168   0]
 [ 16   2   5   1   0 178 183   0]
 [ 17   0   5   2   0 148 153   0]
 [ 17   1   5   2   0 163 168   0]
 [ 17   2   5   1   0 178 183   0]
 [ 18   0   5   2   0 148 153   0]
 [ 18   1   5   2   0 163 168   0]
 [ 18   2   5   1   0 178 183   0]
 [ 19   0   5   2   0 148 153   0]
 [ 19   1   5   2   0 163 168   0]
 [ 19   2   5   1   0 178 183   0]
 [ 20   0   5   2   0 148 153   0]
 [ 20   1   5   2   0 163 168   0]
 [ 20   2   5   1   0 178 183   0]
 [ 21   0   5   2   0 148 153   0]
 [ 21   1   5   2   0 163 168   0]
 [ 21   2   5   1   0 178 183   0]
 [ 22   0   5   2   0 148 153   0]
 [ 22   1   5   2   0 163 168   0]
 [ 22   2   5   1   0 178 183   0]
 [ 23   0   5   2   0 148 153   0]
 [ 23   1   5   2   0 163 168   0]
 [ 23   2   5   1   0 178 183   0]
 [ 24   0   5   2   0 148 153   0]
 [ 24   1   5   2   0 163 168   0]
 [ 24   2   5   1   0 178 183   0]
 [ 25   0   5   2   0 148 153   0]
 [ 25   1   5   2   0 163 168   0]
 [ 25   2   5   1   0 178 183   0]
 [ 26   0   5   2   0 148 153   0]
 [ 26   1   5   2   0 163 168   0]
 [ 26   2   5   1   0 178 183   0]
 [ 27   0   5   2   0 148 153   0]
 [ 27   1   5   2   0 163 168   0]
 [ 27   2   5   1   0 178 183   0]
 [ 28   0   5   2   0 148 153   0]
 [ 28   1   5   2   0 163 168   0]
 [ 28   2   5   1   0 178 183   0]
 [ 29   0   5   2   0 148 153   0]
 [ 29   1   5   2   0 163 168   0]
 [ 29   2   5   1   0 178 183   0]
 [ 30   0   5   2   0 148 153   0]
 [ 30   1   5   2   0 163 168   0]
 [ 30   2   5   1   0 178 183   0]
 [ 31   0   5   2   0 148 153   0]
 [ 31   1   5   2   0 163 168   0]
 [ 31   2   5   1   0 178 183   0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          0.          0.
  6.75333315  0.          1.68833329  1.68833329  8.44166644  0.
  3.37666657  3.37666657  6.75333315  0.          5.06499986  5.06499986
  8.44166644  0.          3.37666657  0.         10.12999972  0.
  5.06499986  1.68833329 11.81833301  0.          0.          3.37666657
 10.12999972  0.          1.68833329  5.06499986 11.81833301  0.
  0.          6.75333315  0.          0.          1.68833329  8.44166644
  1.68833329  0.          3.37666657 10.12999972  0.          0.
  5.06499986 11.81833301  1.68833329  0.          3.37666657  6.75333315
  3.37666657  0.          5.06499986  8.44166644  5.06499986  0.
  0.         10.12999972  3.37666657  0.          1.68833329 11.81833301
  5.06499986  0.          0.          6.75333315  6.75333315  0.
  1.68833329  8.44166644  8.44166644  0.          3.37666657 10.12999972
  6.75333315  0.          5.06499986 11.81833301  8.44166644  0.
  3.37666657  6.75333315 10.12999972  0.          5.06499986  8.44166644
 11.81833301  0.          0.         10.12999972 10.12999972  0.
  1.68833329 11.81833301 11.81833301  0.          5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.14328643  0.75521952 -0.74331592
 -0.77915081 -0.08078366  1.95761895  0.29093741  0.02780209  0.48527241
  0.26332695  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225
 -1.44059548 -1.3150188  -0.76719096 -0.28600475 -0.05699711 -0.98316391
 -1.13158177 -0.64703904  0.43083118  0.15573998  5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.01465273  0.43485666  0.70818476
  0.04545847  0.04722778]
ecpbas  = []
#INFO: **** input file is /central/home/junjiey/work/fftisdf-benchmark/test/diamond-test-build-0/main.py ****
# backend to test #

import pyscf.isdf.BackEnd._config as config

config.disable_fftw()
# config.backend("numpy")
# config.backend("scipy")
config.backend("torch")
# config.backend("torch_gpu")
import pyscf.isdf.BackEnd.isdf_backend as BACKEND

# sys and pyscf #

import numpy as np
from pyscf import lib

from pyscf.lib.parameters import BOHR
from pyscf.pbc import df

# isdf util #

from pyscf.isdf.isdf_tools_Tsym import _kmesh_to_Kpoints, _1e_operator_gamma2k
from pyscf.isdf import isdf_tools_cell
from pyscf.isdf.isdf import ISDF
from pyscf.isdf.isdf_local import ISDF_Local

#############################

ke_cutoff = 70
basis = "gth-dzvp-molopt-sr"

boxlen = 3.57371000
prim_a = np.array([[boxlen, 0.0, 0.0], [0.0, boxlen, 0.0], [0.0, 0.0, boxlen]])
atm = [
    ["C", (0.0, 0.0, 0.0)],
    ["C", (0.8934275, 0.8934275, 0.8934275)],
    ["C", (1.786855, 1.786855, 0.0)],
    ["C", (2.6802825, 2.6802825, 0.8934275)],
    ["C", (1.786855, 0.0, 1.786855)],
    ["C", (2.6802825, 0.8934275, 2.6802825)],
    ["C", (0.0, 1.786855, 1.786855)],
    ["C", (0.8934275, 2.6802825, 2.6802825)],
]

kmeshes = [
    [1, 1, 1],
    [1, 1, 2],
    [1, 2, 2],
    [2, 2, 2],
    [2, 2, 4],
    [2, 4, 4],
    [4, 4, 4],
]  # -44.20339674 and -88.67568935
VERBOSE = 10

prim_cell = isdf_tools_cell.build_supercell(
    atm,
    prim_a,
    Ls=[1, 1, 1],
    ke_cutoff=ke_cutoff,
    basis=basis,
    pseudo="gth-pade",
    verbose=VERBOSE,
)

prim_group = [[0, 1], [2, 3], [4, 5], [6, 7]]

prim_mesh = prim_cell.mesh

for kmesh in kmeshes:

    mesh = [int(k * x) for k, x in zip(kmesh, prim_mesh)]
    print("kmesh:", kmesh, "mesh:", mesh)

    kpts = prim_cell.make_kpts(kmesh)

    cell, group = isdf_tools_cell.build_supercell_with_partition(
        atm,
        prim_a,
        Ls=kmesh,
        ke_cutoff=ke_cutoff,
        partition=prim_group,
        mesh=mesh,
        basis=basis,
        pseudo="gth-pade",
        verbose=VERBOSE,
    )
    
    from pyscf import __config__
    MAX_MEMORY = getattr(__config__, 'MAX_MEMORY')
    cell.max_memory = MAX_MEMORY
    print("cell:", cell.max_memory)
    print("group:", group)

    build_V_K_bunchsize = 512
    isdf = ISDF_Local(
        cell, with_robust_fitting=True, 
        limited_memory=True, 
        build_V_K_bunchsize=build_V_K_bunchsize
    )
    isdf.build(c=30, m=5, rela_cutoff=1e-4, group=group)

    from pyscf.pbc import scf

    mf = scf.RHF(cell)
    mf.with_df = isdf
    mf.max_cycle = 1
    mf.kernel()
    #INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-35-02.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 1
Python 3.12.3 | packaged by conda-forge | (main, Apr 15 2024, 18:38:13) [GCC 12.3.0]
numpy 1.26.4  scipy 1.14.1  h5py 3.12.1
Date: Mon Jan 27 15:31:37 2025
PySCF version 2.7.0
PySCF path  /home/junjiey/anaconda3/envs/fftisdf/lib/python3.12/site-packages/pyscf

[ENV] PYSCF_TMPDIR /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[ENV] PYSCF_MAX_MEMORY 491520
[ENV] PYSCF_EXT_PATH /home/junjiey/packages/pyscf-forge/pyscf-forge-yangjunjie-non-orth/
[CONFIG] ARGPARSE = False
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 491520
[CONFIG] TMPDIR = /central/scratch/yangjunjie//diamond-test-build-0/46998083/
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = None
[INPUT] verbose = 10
[INPUT] max_memory = 2000 
[INPUT] num. atoms = 32
[INPUT] num. electrons = 128
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstorm
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 C      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 C      0.893427500000   0.893427500000   0.893427500000 AA    1.688333287155   1.688333287155   1.688333287155 Bohr   0.0
[INPUT]  3 C      1.786855000000   1.786855000000   0.000000000000 AA    3.376666574310   3.376666574310   0.000000000000 Bohr   0.0
[INPUT]  4 C      2.680282500000   2.680282500000   0.893427500000 AA    5.064999861465   5.064999861465   1.688333287155 Bohr   0.0
[INPUT]  5 C      1.786855000000   0.000000000000   1.786855000000 AA    3.376666574310   0.000000000000   3.376666574310 Bohr   0.0
[INPUT]  6 C      2.680282500000   0.893427500000   2.680282500000 AA    5.064999861465   1.688333287155   5.064999861465 Bohr   0.0
[INPUT]  7 C      0.000000000000   1.786855000000   1.786855000000 AA    0.000000000000   3.376666574310   3.376666574310 Bohr   0.0
[INPUT]  8 C      0.893427500000   2.680282500000   2.680282500000 AA    1.688333287155   5.064999861465   5.064999861465 Bohr   0.0
[INPUT]  9 C      0.000000000000   0.000000000000   3.573710000000 AA    0.000000000000   0.000000000000   6.753333148619 Bohr   0.0
[INPUT] 10 C      0.893427500000   0.893427500000   4.467137500000 AA    1.688333287155   1.688333287155   8.441666435774 Bohr   0.0
[INPUT] 11 C      1.786855000000   1.786855000000   3.573710000000 AA    3.376666574310   3.376666574310   6.753333148619 Bohr   0.0
[INPUT] 12 C      2.680282500000   2.680282500000   4.467137500000 AA    5.064999861465   5.064999861465   8.441666435774 Bohr   0.0
[INPUT] 13 C      1.786855000000   0.000000000000   5.360565000000 AA    3.376666574310   0.000000000000  10.129999722929 Bohr   0.0
[INPUT] 14 C      2.680282500000   0.893427500000   6.253992500000 AA    5.064999861465   1.688333287155  11.818333010084 Bohr   0.0
[INPUT] 15 C      0.000000000000   1.786855000000   5.360565000000 AA    0.000000000000   3.376666574310  10.129999722929 Bohr   0.0
[INPUT] 16 C      0.893427500000   2.680282500000   6.253992500000 AA    1.688333287155   5.064999861465  11.818333010084 Bohr   0.0
[INPUT] 17 C      0.000000000000   3.573710000000   0.000000000000 AA    0.000000000000   6.753333148619   0.000000000000 Bohr   0.0
[INPUT] 18 C      0.893427500000   4.467137500000   0.893427500000 AA    1.688333287155   8.441666435774   1.688333287155 Bohr   0.0
[INPUT] 19 C      1.786855000000   5.360565000000   0.000000000000 AA    3.376666574310  10.129999722929   0.000000000000 Bohr   0.0
[INPUT] 20 C      2.680282500000   6.253992500000   0.893427500000 AA    5.064999861465  11.818333010084   1.688333287155 Bohr   0.0
[INPUT] 21 C      1.786855000000   3.573710000000   1.786855000000 AA    3.376666574310   6.753333148619   3.376666574310 Bohr   0.0
[INPUT] 22 C      2.680282500000   4.467137500000   2.680282500000 AA    5.064999861465   8.441666435774   5.064999861465 Bohr   0.0
[INPUT] 23 C      0.000000000000   5.360565000000   1.786855000000 AA    0.000000000000  10.129999722929   3.376666574310 Bohr   0.0
[INPUT] 24 C      0.893427500000   6.253992500000   2.680282500000 AA    1.688333287155  11.818333010084   5.064999861465 Bohr   0.0
[INPUT] 25 C      0.000000000000   3.573710000000   3.573710000000 AA    0.000000000000   6.753333148619   6.753333148619 Bohr   0.0
[INPUT] 26 C      0.893427500000   4.467137500000   4.467137500000 AA    1.688333287155   8.441666435774   8.441666435774 Bohr   0.0
[INPUT] 27 C      1.786855000000   5.360565000000   3.573710000000 AA    3.376666574310  10.129999722929   6.753333148619 Bohr   0.0
[INPUT] 28 C      2.680282500000   6.253992500000   4.467137500000 AA    5.064999861465  11.818333010084   8.441666435774 Bohr   0.0
[INPUT] 29 C      1.786855000000   3.573710000000   5.360565000000 AA    3.376666574310   6.753333148619  10.129999722929 Bohr   0.0
[INPUT] 30 C      2.680282500000   4.467137500000   6.253992500000 AA    5.064999861465   8.441666435774  11.818333010084 Bohr   0.0
[INPUT] 31 C      0.000000000000   5.360565000000   5.360565000000 AA    0.000000000000  10.129999722929  10.129999722929 Bohr   0.0
[INPUT] 32 C      0.893427500000   6.253992500000   6.253992500000 AA    1.688333287155  11.818333010084  11.818333010084 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] C
[INPUT] 0    0    [5    /2   ]  5.6053307517      0.1115328819 0.4665074832
                                2.11301639053     0.1531421941 0.1441132128
                                0.76991145481     -0.3213968794 0.0293648809
                                0.348157086385    -0.6109264216 0.9294703884
                                0.12821225471     -0.1339908628 1.0669143312
[INPUT] 1    0    [5    /2   ]  5.6053307517      -0.0648689785 -0.0554756934
                                2.11301639053     -0.2004702557 -0.2161651752
                                0.76991145481     -0.4131417301 -0.4366242723
                                0.348157086385    -0.4153371392 0.7840006984
                                0.12821225471     -0.2885276736 0.987908135
[INPUT] 2    0    [5    /1   ]  5.6053307517      0.0299527746
                                2.11301639053     0.0707844588
                                0.76991145481     0.6746010586
                                0.348157086385    0.1736520618
                                0.12821225471     1.0363170247

Ewald components = 107.843734373629, -312.164399685187, 0.122194870153274
nuclear repulsion = -204.198470441405
number of shells = 96
number of NR pGTOs = 1440
number of NR cGTOs = 416
basis = gth-dzvp-molopt-sr
ecp = {}
bas 0, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 1, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 2, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 3, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 4, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 5, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 6, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 7, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 8, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 9, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 10, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 11, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 12, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 13, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 14, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 15, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 16, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 17, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 18, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 19, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 20, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 21, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 22, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 23, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 24, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 25, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 26, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 27, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 28, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 29, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 30, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 31, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 32, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 33, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 34, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 35, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 36, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 37, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 38, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 39, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 40, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 41, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 42, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 43, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 44, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 45, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 46, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 47, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 48, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 49, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 50, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 51, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 52, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 53, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 54, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 55, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 56, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 57, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 58, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 59, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 60, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 61, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 62, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 63, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 64, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 65, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 66, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 67, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 68, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 69, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 70, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 71, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 72, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 73, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 74, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 75, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 76, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 77, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 78, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 79, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 80, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 81, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 82, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 83, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 84, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 85, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 86, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 87, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 88, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 89, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 90, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 91, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 92, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 93, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 94, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
bas 95, expnt(s) = [5.60533075 2.11301639 0.76991145 0.34815709 0.12821225]
CPU time:      4063.35
lattice vectors  a1 [6.753333149, 0.000000000, 0.000000000]
                 a2 [0.000000000, 13.506666297, 0.000000000]
                 a3 [0.000000000, 0.000000000, 13.506666297]
dimension = 3
low_dim_ft_type = None
Cell volume = 1232.01
rcut = 22.25045319935835 (nimgs = [4 2 2])
lattice sum = 411 cells
precision = 1e-08
pseudo = gth-pade
mesh = [27, 54, 54] (78732 PWs)
    = ke_cutoff [73.14423411 73.14423411 73.14423411]
cell: 491520
group: [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11], [12, 13], [14, 15], [16, 17], [18, 19], [20, 21], [22, 23], [24, 25], [26, 27], [28, 29], [30, 31]]
ISDF: mol.ke_cutoff = 70.000000
ISDF: mol.natm      = 32
ISDF: mol.nao       = 416
************* get_partition *************
************* end get_partition *************
       get_partition wall time:     0.294555 CPU time:     2.285285
len of partition[   0] =   2677
len of partition[   1] =   2246
len of partition[   2] =   2677
len of partition[   3] =   2259
len of partition[   4] =   2665
len of partition[   5] =   2256
len of partition[   6] =   2663
len of partition[   7] =   2250
len of partition[   8] =   2677
len of partition[   9] =   2250
len of partition[  10] =   2650
len of partition[  11] =   2263
len of partition[  12] =   2679
len of partition[  13] =   2264
len of partition[  14] =   2666
len of partition[  15] =   2258
len of partition[  16] =   2677
len of partition[  17] =   2248
len of partition[  18] =   2667
len of partition[  19] =   2253
len of partition[  20] =   2635
len of partition[  21] =   2253
len of partition[  22] =   2665
len of partition[  23] =   2254
len of partition[  24] =   2677
len of partition[  25] =   2260
len of partition[  26] =   2659
len of partition[  27] =   2262
len of partition[  28] =   2646
len of partition[  29] =   2252
len of partition[  30] =   2664
len of partition[  31] =   2260
************* get_aoR *************
************* end get_aoR *************
             get_aoR wall time:     9.265845 CPU time:     9.251479
In _build_buffer: ISDF Local size of buffer = 326.958 MB
 ---------- In pyscf.isdf.isdf_local.select_IP_local_atm ----------
select_IP_local_atm: atm_begin =    0, atm_end =   32
select_IP_local_atm: npt_found =  512
select_IP_local_atm: npt_found =  468
select_IP_local_atm: npt_found =  516
select_IP_local_atm: npt_found =  474
select_IP_local_atm: npt_found =  509
select_IP_local_atm: npt_found =  476
select_IP_local_atm: npt_found =  519
select_IP_local_atm: npt_found =  474
select_IP_local_atm: npt_found =  511
select_IP_local_atm: npt_found =  487
select_IP_local_atm: npt_found =  502
select_IP_local_atm: npt_found =  468
select_IP_local_atm: npt_found =  484
select_IP_local_atm: npt_found =  472
select_IP_local_atm: npt_found =  512
select_IP_local_atm: npt_found =  486
select_IP_local_atm: npt_found =  500
select_IP_local_atm: npt_found =  460
select_IP_local_atm: npt_found =  503
select_IP_local_atm: npt_found =  476
select_IP_local_atm: npt_found =  484
select_IP_local_atm: npt_found =  476
select_IP_local_atm: npt_found =  509
select_IP_local_atm: npt_found =  485
select_IP_local_atm: npt_found =  508
select_IP_local_atm: npt_found =  466
select_IP_local_atm: npt_found =  515
select_IP_local_atm: npt_found =  472
select_IP_local_atm: npt_found =  510
select_IP_local_atm: npt_found =  449
select_IP_local_atm: npt_found =  524
select_IP_local_atm: npt_found =  476
select_IP_local_step1 wall time:     3.326055 CPU time:   211.988656
 build_aoRg_possible wall time:     0.043942 CPU time:     2.809438
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  980
select_IP_local_group: npt_found =  792
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  990
select_IP_local_group: npt_found =  815
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  985
select_IP_local_group: npt_found =  808
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  993
select_IP_local_group: npt_found =  789
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  998
select_IP_local_group: npt_found =  820
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  970
select_IP_local_group: npt_found =  792
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  956
select_IP_local_group: npt_found =  785
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  998
select_IP_local_group: npt_found =  812
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  960
select_IP_local_group: npt_found =  779
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  979
select_IP_local_group: npt_found =  825
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  960
select_IP_local_group: npt_found =  784
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  994
select_IP_local_group: npt_found =  795
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  974
select_IP_local_group: npt_found =  789
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  987
select_IP_local_group: npt_found =  799
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  =  959
select_IP_local_group: npt_found =  810
select_IP_local_group: nao_group =   26
select_IP_local_group: naux_now  =   32
select_IP_local_group: max_rank  = 1000
select_IP_local_group: npt_found =  798
select_IP_local_step2 wall time:     1.284152 CPU time:    81.975955
select_IP_local_step3 wall time:     0.118530 CPU time:     6.351035
Memory usage for aoR  :    249.983 MB
Memory usage for aoRg :     40.701 MB
            build_IP wall time:     4.772678 CPU time:   303.125084
build_aux_basis_local wall time:     0.785462 CPU time:    49.134999
 ---------- In pyscf.isdf.isdf_local.build_V_W_local ----------
Memory usage for V:   7683.866 MB
Memory usage for W:   1248.438 MB
     build_V_W_local wall time:    35.486509 CPU time:   229.694329


******** <class 'pyscf.pbc.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-07
SCF conv_tol_grad = None
SCF max_cycles = 1
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /central/scratch/yangjunjie/diamond-test-build-0/46998083/tmp2m7_v0up
max_memory 491520 MB (current use 11784 MB)
******** PBC SCF flags ********
kpt = [0. 0. 0.]
Exchange divergence treatment (exxdiv) = ewald
Ewald components = 0.00052338569450741, -0.185982990105016, 0.0768750832611235
    madelung (= occupied orbital energy shift) = 0.21716904229876946
    Total energy shift due to Ewald probe charge = -1/2 * Nelec*madelung = -13.8988187071
DF object = <pyscf.isdf.isdf_local.ISDF_Local object at 0x7f94f1775310>
Set gradient conv threshold to 0.000316228
Initial guess from minao.
Big error detected in the electron number of initial guess density matrix (Ne/cell = 127.438)!
  This can cause huge error in Fock matrix and lead to instability in SCF for low-dimensional systems.
  DM is normalized wrt the number of electrons 128
arg.atm = [[  4  20   1  23   0   0]
 [  4  24   1  27   0   0]
 [  4  28   1  31   0   0]
 [  4  32   1  35   0   0]
 [  4  36   1  39   0   0]
 [  4  40   1  43   0   0]
 [  4  44   1  47   0   0]
 [  4  48   1  51   0   0]
 [  4  52   1  55   0   0]
 [  4  56   1  59   0   0]
 [  4  60   1  63   0   0]
 [  4  64   1  67   0   0]
 [  4  68   1  71   0   0]
 [  4  72   1  75   0   0]
 [  4  76   1  79   0   0]
 [  4  80   1  83   0   0]
 [  4  84   1  87   0   0]
 [  4  88   1  91   0   0]
 [  4  92   1  95   0   0]
 [  4  96   1  99   0   0]
 [  4 100   1 103   0   0]
 [  4 104   1 107   0   0]
 [  4 108   1 111   0   0]
 [  4 112   1 115   0   0]
 [  4 116   1 119   0   0]
 [  4 120   1 123   0   0]
 [  4 124   1 127   0   0]
 [  4 128   1 131   0   0]
 [  4 132   1 135   0   0]
 [  4 136   1 139   0   0]
 [  4 140   1 143   0   0]
 [  4 144   1 147   0   0]]
arg.bas = [[  0   0   5   2   0 148 153   0]
 [  0   1   5   2   0 163 168   0]
 [  0   2   5   1   0 178 183   0]
 [  1   0   5   2   0 148 153   0]
 [  1   1   5   2   0 163 168   0]
 [  1   2   5   1   0 178 183   0]
 [  2   0   5   2   0 148 153   0]
 [  2   1   5   2   0 163 168   0]
 [  2   2   5   1   0 178 183   0]
 [  3   0   5   2   0 148 153   0]
 [  3   1   5   2   0 163 168   0]
 [  3   2   5   1   0 178 183   0]
 [  4   0   5   2   0 148 153   0]
 [  4   1   5   2   0 163 168   0]
 [  4   2   5   1   0 178 183   0]
 [  5   0   5   2   0 148 153   0]
 [  5   1   5   2   0 163 168   0]
 [  5   2   5   1   0 178 183   0]
 [  6   0   5   2   0 148 153   0]
 [  6   1   5   2   0 163 168   0]
 [  6   2   5   1   0 178 183   0]
 [  7   0   5   2   0 148 153   0]
 [  7   1   5   2   0 163 168   0]
 [  7   2   5   1   0 178 183   0]
 [  8   0   5   2   0 148 153   0]
 [  8   1   5   2   0 163 168   0]
 [  8   2   5   1   0 178 183   0]
 [  9   0   5   2   0 148 153   0]
 [  9   1   5   2   0 163 168   0]
 [  9   2   5   1   0 178 183   0]
 [ 10   0   5   2   0 148 153   0]
 [ 10   1   5   2   0 163 168   0]
 [ 10   2   5   1   0 178 183   0]
 [ 11   0   5   2   0 148 153   0]
 [ 11   1   5   2   0 163 168   0]
 [ 11   2   5   1   0 178 183   0]
 [ 12   0   5   2   0 148 153   0]
 [ 12   1   5   2   0 163 168   0]
 [ 12   2   5   1   0 178 183   0]
 [ 13   0   5   2   0 148 153   0]
 [ 13   1   5   2   0 163 168   0]
 [ 13   2   5   1   0 178 183   0]
 [ 14   0   5   2   0 148 153   0]
 [ 14   1   5   2   0 163 168   0]
 [ 14   2   5   1   0 178 183   0]
 [ 15   0   5   2   0 148 153   0]
 [ 15   1   5   2   0 163 168   0]
 [ 15   2   5   1   0 178 183   0]
 [ 16   0   5   2   0 148 153   0]
 [ 16   1   5   2   0 163 168   0]
 [ 16   2   5   1   0 178 183   0]
 [ 17   0   5   2   0 148 153   0]
 [ 17   1   5   2   0 163 168   0]
 [ 17   2   5   1   0 178 183   0]
 [ 18   0   5   2   0 148 153   0]
 [ 18   1   5   2   0 163 168   0]
 [ 18   2   5   1   0 178 183   0]
 [ 19   0   5   2   0 148 153   0]
 [ 19   1   5   2   0 163 168   0]
 [ 19   2   5   1   0 178 183   0]
 [ 20   0   5   2   0 148 153   0]
 [ 20   1   5   2   0 163 168   0]
 [ 20   2   5   1   0 178 183   0]
 [ 21   0   5   2   0 148 153   0]
 [ 21   1   5   2   0 163 168   0]
 [ 21   2   5   1   0 178 183   0]
 [ 22   0   5   2   0 148 153   0]
 [ 22   1   5   2   0 163 168   0]
 [ 22   2   5   1   0 178 183   0]
 [ 23   0   5   2   0 148 153   0]
 [ 23   1   5   2   0 163 168   0]
 [ 23   2   5   1   0 178 183   0]
 [ 24   0   5   2   0 148 153   0]
 [ 24   1   5   2   0 163 168   0]
 [ 24   2   5   1   0 178 183   0]
 [ 25   0   5   2   0 148 153   0]
 [ 25   1   5   2   0 163 168   0]
 [ 25   2   5   1   0 178 183   0]
 [ 26   0   5   2   0 148 153   0]
 [ 26   1   5   2   0 163 168   0]
 [ 26   2   5   1   0 178 183   0]
 [ 27   0   5   2   0 148 153   0]
 [ 27   1   5   2   0 163 168   0]
 [ 27   2   5   1   0 178 183   0]
 [ 28   0   5   2   0 148 153   0]
 [ 28   1   5   2   0 163 168   0]
 [ 28   2   5   1   0 178 183   0]
 [ 29   0   5   2   0 148 153   0]
 [ 29   1   5   2   0 163 168   0]
 [ 29   2   5   1   0 178 183   0]
 [ 30   0   5   2   0 148 153   0]
 [ 30   1   5   2   0 163 168   0]
 [ 30   2   5   1   0 178 183   0]
 [ 31   0   5   2   0 148 153   0]
 [ 31   1   5   2   0 163 168   0]
 [ 31   2   5   1   0 178 183   0]]
arg.env = [ 0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  0.          0.          0.          0.          0.          0.
  1.68833329  1.68833329  1.68833329  0.          3.37666657  3.37666657
  0.          0.          5.06499986  5.06499986  1.68833329  0.
  3.37666657  0.          3.37666657  0.          5.06499986  1.68833329
  5.06499986  0.          0.          3.37666657  3.37666657  0.
  1.68833329  5.06499986  5.06499986  0.          0.          0.
  6.75333315  0.          1.68833329  1.68833329  8.44166644  0.
  3.37666657  3.37666657  6.75333315  0.          5.06499986  5.06499986
  8.44166644  0.          3.37666657  0.         10.12999972  0.
  5.06499986  1.68833329 11.81833301  0.          0.          3.37666657
 10.12999972  0.          1.68833329  5.06499986 11.81833301  0.
  0.          6.75333315  0.          0.          1.68833329  8.44166644
  1.68833329  0.          3.37666657 10.12999972  0.          0.
  5.06499986 11.81833301  1.68833329  0.          3.37666657  6.75333315
  3.37666657  0.          5.06499986  8.44166644  5.06499986  0.
  0.         10.12999972  3.37666657  0.          1.68833329 11.81833301
  5.06499986  0.          0.          6.75333315  6.75333315  0.
  1.68833329  8.44166644  8.44166644  0.          3.37666657 10.12999972
  6.75333315  0.          5.06499986 11.81833301  8.44166644  0.
  3.37666657  6.75333315 10.12999972  0.          5.06499986  8.44166644
 11.81833301  0.          0.         10.12999972 10.12999972  0.
  1.68833329 11.81833301 11.81833301  0.          5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.14328643  0.75521952 -0.74331592
 -0.77915081 -0.08078366  1.95761895  0.29093741  0.02780209  0.48527241
  0.26332695  5.60533075  2.11301639  0.76991145  0.34815709  0.12821225
 -1.44059548 -1.3150188  -0.76719096 -0.28600475 -0.05699711 -0.98316391
 -1.13158177 -0.64703904  0.43083118  0.15573998  5.60533075  2.11301639
  0.76991145  0.34815709  0.12821225  1.01465273  0.43485666  0.70818476
  0.04545847  0.04722778]
ecpbas  = []
    CPU time for pbc integral int3c1e_sph     15.07 sec, wall time      8.99 sec
    CPU time for pbc integral int3c1e_r2_origk_sph     10.95 sec, wall time     10.96 sec
ke_cutoff for multigrid tasks:
[2.5925925925925926, 7.777777777777778, 23.333333333333332, 70]
meshes for multigrid tasks:
[array([ 7, 11, 11]), array([11, 19, 19]), array([17, 31, 31]), array([27, 53, 53])]
              get_pp wall time:    31.410201 CPU time:    40.667529
Building PBC AO integrals incore
